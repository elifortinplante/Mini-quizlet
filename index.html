<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Quizlet Final</title>
<style>
  body {margin:0; font-family:system-ui,sans-serif; background:linear-gradient(135deg,#6366f1,#ec4899,#f59e0b); color:white; display:flex; flex-direction:column; align-items:center; min-height:100vh;}
  h1,h2,h3 {margin:0;}
  button {padding:0.5rem 1rem; border-radius:0.5rem; border:none; font-weight:bold; cursor:pointer;}
  .btn-primary {background:#4f46e5; color:white;}
  .btn-secondary {background:white; color:#4f46e5;}
  input {padding:0.5rem; border-radius:0.5rem; border:none; width:100%; margin-bottom:0.5rem;}
  #setsList, #cardsList {width:90%; max-width:400px; margin-top:1rem;}
  .set-card, .card {background:white; color:black; border-radius:1rem; margin-bottom:1rem; padding:1rem; box-shadow:0 5px 15px rgba(0,0,0,0.2); position:relative; user-select:none;}
  .card {width:300px; height:400px; display:flex; flex-direction:column; justify-content:center; align-items:center; perspective:1000px; margin:2rem auto;}
  .card-inner {width:100%; height:100%; text-align:center; border-radius:1rem; transition:transform 0.6s; transform-style:preserve-3d; position:relative;}
  .card.flipped .card-inner {transform:rotateY(180deg);}
  .card-front, .card-back {position:absolute; width:100%; height:100%; backface-visibility:hidden; display:flex; flex-direction:column; justify-content:center; align-items:center; border-radius:1rem; font-size:1.2rem; padding:1rem; box-sizing:border-box; overflow:hidden;}
  .card-back {transform:rotateY(180deg);}
  .card img {position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; border-radius:1rem; opacity:0.5;}
  .card-text {position:relative; z-index:1;}
  .swipe-area {position:absolute; inset:0; z-index:2;}
</style>
</head>
<body>

<h1>Mini Quizlet Final</h1>

<div id="home">
  <button id="btnNewSet" class="btn-primary">+ Nouveau set</button>
  <div id="setsList"></div>
</div>

<div id="editor" style="display:none; width:90%; max-width:400px;">
  <h2>√âditeur de set</h2>
  <input id="setTitle" placeholder="Titre du set">
  <input id="setSubject" placeholder="Mati√®re">
  <button id="btnAddCard" class="btn-primary">+ Ajouter une carte</button>
  <div id="cardsList"></div>
  <button id="btnStartStudy" class="btn-primary">‚ñ∂ √âtudier</button>
  <button id="btnBackHome" class="btn-secondary">‚Üê Accueil</button>
</div>

<div id="study" style="display:none;">
  <h2 id="studyTitle"></h2>
  <h3 id="studySubject"></h3>
  <div class="card" id="studyCard">
    <div class="card-inner">
      <div class="card-front"><img id="frontImg"><div class="card-text" id="frontText"></div></div>
      <div class="card-back"><img id="backImg"><div class="card-text" id="backText"></div></div>
    </div>
    <div class="swipe-area"></div>
  </div>
  <div style="text-align:center;">
    <button id="btnRestartAll" class="btn-primary">Tout recommencer</button>
    <button id="btnAgainWrong" class="btn-secondary">Reprendre erreurs</button>
  </div>
</div>

<script>
// --- stockage ---
const LS_KEY='miniQuizletSets';
let sets=JSON.parse(localStorage.getItem(LS_KEY)||'[]');
let currentSet=null;
let study={order:[],index:0,wrong:[],score:0};

// --- √©l√©ments ---
const home=document.getElementById('home');
const editor=document.getElementById('editor');
const studyDiv=document.getElementById('study');
const setsList=document.getElementById('setsList');
const cardsList=document.getElementById('cardsList');
const setTitle=document.getElementById('setTitle');
const setSubject=document.getElementById('setSubject');
const studyCard=document.getElementById('studyCard');
const frontText=document.getElementById('frontText');
const backText=document.getElementById('backText');
const frontImg=document.getElementById('frontImg');
const backImg=document.getElementById('backImg');
const studyTitle=document.getElementById('studyTitle');
const studySubject=document.getElementById('studySubject');

// --- fonctions ---
function save(){localStorage.setItem(LS_KEY,JSON.stringify(sets));}
function showHome(){home.style.display='block'; editor.style.display='none'; studyDiv.style.display='none'; renderSets();}
function showEditor(){home.style.display='none'; editor.style.display='block'; studyDiv.style.display='none'; renderEditor();}
function showStudy(){home.style.display='none'; editor.style.display='none'; studyDiv.style.display='block';}

function renderSets(){
  setsList.innerHTML='';
  sets.forEach((s,i)=>{
    const div=document.createElement('div');
    div.className='set-card';
    div.innerHTML=`<strong>${s.title}</strong><br>${s.subject}<br>
      <button data-index="${i}" class="btn-primary btnEdit">Modifier</button>
      <button data-index="${i}" class="btn-primary btnPlay">Jouer</button>
      <button data-index="${i}" class="btn-secondary btnDel">Supprimer</button>`;
    setsList.appendChild(div);
  });
  document.querySelectorAll('.btnEdit').forEach(b=>b.onclick=e=>{currentSet=sets[b.dataset.index]; showEditor();});
  document.querySelectorAll('.btnPlay').forEach(b=>b.onclick=e=>{currentSet=sets[b.dataset.index]; startStudy(false);});
  document.querySelectorAll('.btnDel').forEach(b=>b.onclick=e=>{sets.splice(b.dataset.index,1); save(); renderSets();});
}

function renderEditor(){
  setTitle.value=currentSet.title;
  setSubject.value=currentSet.subject;
  cardsList.innerHTML='';
  currentSet.cards.forEach((c,idx)=>{
    const div=document.createElement('div');
    div.className='set-card';
    div.innerHTML=`<input placeholder="Question" value="${c.front}" class="front">
                     <input placeholder="R√©ponse" value="${c.back}" class="back">
                     <input placeholder="URL image" value="${c.img||''}" class="img">
                     <button data-idx="${idx}" class="btn-secondary btnDelCard">üóëÔ∏è</button>`;
    cardsList.appendChild(div);
  });
  document.querySelectorAll('.btnDelCard').forEach(b=>b.onclick=e=>{
    currentSet.cards.splice(b.dataset.idx,1); renderEditor();
  });
}

document.getElementById('btnNewSet').onclick=()=>{
  const s={title:'Nouveau set',subject:'',cards:[]};
  sets.push(s); currentSet=s; save(); showEditor();
};
document.getElementById('btnAddCard').onclick=()=>{
  currentSet.cards.push({front:'',back:'',img:''}); renderEditor();
};
document.getElementById('btnStartStudy').onclick=()=>{
  currentSet.title=setTitle.value;
  currentSet.subject=setSubject.value;
  save();
  startStudy(false);
};
document.getElementById('btnBackHome').onclick=()=>showHome();

function startStudy(restartWrong){
  if(!currentSet.cards.length){alert('Ajoute des cartes !'); return;}
  study.order=restartWrong?study.wrong.slice():currentSet.cards.map((c,i)=>i);
  study.index=0; study.wrong=[]; study.score=0;
  studyTitle.textContent=currentSet.title;
  studySubject.textContent=currentSet.subject;
  showStudy();
  showCard();
}

function showCard(){
  if(study.index>=study.order.length){
    alert(`Termin√© ! Score: ${study.score}/${study.order.length}`);
    showHome();
    return;
  }
  const c=currentSet.cards[study.order[study.index]];
  frontText.textContent=c.front; backText.textContent=c.back;
  frontImg.src=c.img||''; backImg.src=c.img||'';
  document.querySelector('.card-inner').classList.remove('flipped');
}

// rotation
document.querySelector('.card').onclick=()=>{document.querySelector('.card-inner').classList.toggle('flipped');};

// swipe
let startX=null;
studyCard.querySelector('.swipe-area').addEventListener('touchstart',e=>{startX=e.touches[0].clientX;});
studyCard.querySelector('.swipe-area').addEventListener('touchend',e=>{
  const dx=e.changedTouches[0].clientX-startX;
  if(dx>50) markCard(true);
  else if(dx<-50) markCard(false);
});

function markCard(ok){
  const idx=study.order[study.index];
  if(!ok) study.wrong.push(idx); else study.score++;
  study.index++; showCard();
}

document.getElementById('btnRestartAll').onclick=()=>startStudy(false);
document.getElementById('btnAgainWrong').onclick=()=>startStudy(true);

// --- init ---
showHome();
</script>

</body>
</html>

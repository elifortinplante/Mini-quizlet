<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mini-Quizlet ++</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,#6366f1,#ec4899,#10b981);color:white;min-height:100vh;}
.btn{padding:.7rem 1rem;border-radius:9999px;font-weight:700;}
.btn-primary{background:linear-gradient(90deg,#6366f1,#ec4899);color:white;}
.btn-secondary{background:white;color:#4f46e5;border:2px solid #4f46e5;}
.chip{background:#dbeafe;color:#1e3a8a;padding:.25rem .6rem;border-radius:9999px;font-size:.8rem;font-weight:700;}
.input{width:100%;padding:.6rem .8rem;border-radius:14px;border:2px solid #e5e7eb;background:white;color:black;}
.set-card{background:white;color:black;border-radius:20px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.18);}
.mini-thumb{width:48px;height:48px;border-radius:12px;object-fit:cover;background:#eef;}
.stage{perspective:1200px;}
.card{width:100vw;height:100vh;border-radius:0;background:white;color:black;position:relative;transform-style:preserve-3d;transition:transform .6s;display:flex;align-items:center;justify-content:center;overflow:hidden;}
.card-face{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;backface-visibility:hidden;padding:20px;box-sizing:border-box;}
.card-front{transform:rotateY(0);}
.card-back{transform:rotateY(180deg);}
.flipped{transform:rotateY(180deg);}
.answer{text-align:center;font-size:1.2rem;font-weight:700;color:black;text-shadow:1px 1px 3px rgba(255,255,255,0.8);}
.card img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;}
.swipe-btn{position:absolute;top:50%;transform:translateY(-50%);font-size:3rem;cursor:pointer;user-select:none;}
#btnMal{left:20px;color:#ef4444;}
#btnBien{right:20px;color:#22c55e;}
</style>
</head>
<body class="pb-20">
<header class="max-w-4xl mx-auto px-4 pt-5 flex items-center justify-between">
  <div class="flex items-center gap-3">
    <div class="w-11 h-11 rounded-2xl bg-white text-indigo-600 grid place-items-center font-extrabold">MQ+</div>
    <div>
      <h1 class="text-2xl font-extrabold drop-shadow">Mini-Quizlet ++</h1>
      <p class="text-indigo-100 text-sm -mt-1">√âtudier en s‚Äôamusant ‚ú®</p>
    </div>
  </div>
  <div class="flex items-center gap-2">
    <button id="btnTheme" class="btn btn-secondary">üé® Th√®me</button>
    <button id="btnNewSet" class="btn btn-primary">+ Nouveau set</button>
  </div>
</header>

<main class="max-w-4xl mx-auto px-4 pt-4">
<section id="viewHome" class="space-y-4">
  <div id="setsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
  <p id="emptyMsg" class="text-center text-white/90 hidden">Aucun set. Cr√©e ton premier ‚ú®</p>
</section>

<section id="viewEditor" class="hidden">
  <div class="flex items-center justify-between mb-3">
    <button class="btn btn-secondary" id="btnBackHome1">‚Üê Accueil</button>
    <button class="btn btn-primary" id="btnStudyFromEditor">‚ñ∂ √âtudier</button>
  </div>
  <div class="grid sm:grid-cols-2 gap-3 mb-3">
    <div>
      <label class="text-sm font-bold">Titre du set</label>
      <input id="setTitle" class="input" placeholder="Ex: Vocabulaire anglais">
    </div>
    <div>
      <label class="text-sm font-bold">Mati√®re</label>
      <input id="setSubject" class="input" placeholder="Ex: Anglais">
    </div>
    <div>
      <label class="text-sm font-bold">Image du set (URL)</label>
      <input id="setImage" class="input" placeholder="https://...">
    </div>
  </div>
  <div class="flex items-center justify-between mb-2">
    <h3 class="font-extrabold">Cartes</h3>
    <button id="btnAddCard" class="btn btn-primary">+ Ajouter</button>
  </div>
  <div id="cardsList" class="space-y-3"></div>
</section>

<section id="viewStudy" class="hidden">
  <div class="flex items-center justify-between mb-2">
    <button class="btn btn-secondary" id="btnBackHome2">‚Üê Accueil</button>
    <div class="flex items-center gap-2">
      <span id="progressChip" class="chip">0/0</span>
    </div>
  </div>
  <div class="text-center mb-2">
    <div id="studySetTitle" class="text-xl font-extrabold"></div>
    <div id="studySetSubject" class="text-indigo-100"></div>
  </div>
  <div class="stage">
    <div id="card" class="card">
      <div class="card-face card-front"><div id="frontText"></div></div>
      <div class="card-face card-back"><div id="backText"></div></div>
    </div>
    <div id="btnMal" class="swipe-btn">‚ùå</div>
    <div id="btnBien" class="swipe-btn">‚úÖ</div>
  </div>
  <div class="text-center mt-5 hidden" id="endButtons">
    <button id="btnAgainWrong" class="btn btn-secondary">Reprendre erreurs</button>
    <button id="btnRestartAll" class="btn btn-primary">Tout recommencer</button>
    <button id="btnHomeEnd" class="btn btn-secondary">Accueil</button>
  </div>
</section>
</main>

<template id="tplSet">
  <div class="set-card p-4 flex items-center gap-3">
    <img class="mini-thumb"/>
    <div class="flex-1">
      <div class="font-extrabold text-black/90 set-title">Titre</div>
      <div class="text-sm text-slate-500 set-subject">Mati√®re</div>
    </div>
    <div class="flex flex-col gap-2">
      <button class="btn btn-primary btn-edit">Modifier</button>
      <button class="btn btn-primary btn-play">Jouer</button>
      <button class="btn btn-secondary btn-del">Supprimer</button>
    </div>
  </div>
</template>

<template id="tplCardRow">
  <div class="set-card p-3">
    <input class="input input-front" placeholder="Question">
    <input class="input input-back" placeholder="R√©ponse">
    <input class="input input-img" placeholder="Image URL">
    <button class="btn btn-secondary btn-del-card">üóëÔ∏è Carte</button>
  </div>
</template>

<script>
// Data
const LS_KEY='mq_plus_sets';
let sets=[], currentSetId=null, study={order:[],i:0,wrong:[],finished:false};
const $=(s)=>document.querySelector(s);
const $$=(s)=>document.querySelectorAll(s);
const uid=()=>Math.random().toString(36).slice(2,9);

function load(){try{sets=JSON.parse(localStorage.getItem(LS_KEY)||'[]');}catch{sets=[]}}
function save(){localStorage.setItem(LS_KEY,JSON.stringify(sets))}
function findSet(id){return sets.find(s=>s.id===id)}
function upsertSet(s){const i=sets.findIndex(x=>x.id===s.id); if(i>-1) sets[i]=s; else sets.push(s); save()}

// Views
const viewHome=$('#viewHome'), viewEditor=$('#viewEditor'), viewStudy=$('#viewStudy');
function showHome(){viewHome.classList.remove('hidden');viewEditor.classList.add('hidden');viewStudy.classList.add('hidden');renderSets()}
function showEditor(){viewHome.classList.add('hidden');viewEditor.classList.remove('hidden');viewStudy.classList.add('hidden')}
function showStudy(){viewHome.classList.add('hidden');viewEditor.classList.add('hidden');viewStudy.classList.remove('hidden')}

// Render
function renderSets(){
  const grid=$('#setsGrid');grid.innerHTML='';
  if(sets.length===0) $('#emptyMsg').classList.remove('hidden'); else $('#emptyMsg').classList.add('hidden');
  sets.forEach(s=>{
    const tpl=document.getElementById('tplSet').content.cloneNode(true);
    tpl.querySelector('.set-title').textContent=s.title;
    tpl.querySelector('.set-subject').textContent=s.subject;
    tpl.querySelector('.mini-thumb').src=s.image||'https://via.placeholder.com/48';
    tpl.querySelector('.btn-edit').onclick=()=>editSet(s.id);
    tpl.querySelector('.btn-play').onclick=()=>studySet(s.id);
    tpl.querySelector('.btn-del').onclick=()=>{sets=sets.filter(x=>x.id!==s.id);save();renderSets();}
    grid.appendChild(tpl);
  })
}

function editSet(id){
  currentSetId=id;
  const s=findSet(id);
  showEditor();
  $('#setTitle').value=s.title; $('#setSubject').value=s.subject; $('#setImage').value=s.image||'';
  renderCards(s.cards||[]);
}

function renderCards(cards){
  const list=$('#cardsList'); list.innerHTML='';
  cards.forEach(c=>{
    const tpl=document.getElementById('tplCardRow').content.cloneNode(true);
    tpl.querySelector('.input-front').value=c.front;
    tpl.querySelector('.input-back').value=c.back;
    tpl.querySelector('.input-img').value=c.img||'';
    tpl.querySelector('.btn-del-card').onclick=()=>{
      cards.splice(cards.indexOf(c),1); save(); renderCards(cards);
    }
    list.appendChild(tpl);
  })
}

$('#btnNewSet').onclick=()=>{
  const id=uid();
  const newSet={id,title:'Nouveau set',subject:'Mati√®re',image:'',cards:[]};
  sets.push(newSet); save(); renderSets(); editSet(id);
}

$('#btnAddCard').onclick=()=>{
  const s=findSet(currentSetId); s.cards.push({front:'',back:'',img:''}); save(); renderCards(s.cards);
}

// Auto-save inputs
['setTitle','setSubject','setImage'].forEach(id=>$('#'+id).addEventListener('input',()=>{
  const s=findSet(currentSetId); s[id.replace('set','').toLowerCase()]= $('#'+id).value; save();
}));

// Card input auto-save
$('#cardsList').addEventListener('input',e=>{
  if(e.target.classList.contains('input-front')||e.target.classList.contains('input-back')||e.target.classList.contains('input-img')){
    const s=findSet(currentSetId);
    const idx=[...$('#cardsList').children].indexOf(e.target.closest('.set-card'));
    if(idx>-1){
      s.cards[idx].front=$('#cardsList').children[idx].querySelector('.input-front').value;
      s.cards[idx].back=$('#cardsList').children[idx].querySelector('.input-back').value;
      s.cards[idx].img=$('#cardsList').children[idx].querySelector('.input-img').value;
      save();
    }
  }
});

// Study
function studySet(id){
  const s=findSet(id);
  currentSetId=id; showStudy();
  $('#studySetTitle').textContent=s.title;
  $('#studySetSubject').textContent=s.subject;
  study.order=s.cards.map((_,i)=>i); study.i=0; study.wrong=[]; study.finished=false;
  showCard();
}

function showCard(){
  const s=findSet(currentSetId);
  if(study.i>=study.order.length){endStudy();return;}
  const idx=study.order[study.i]; const c=s.cards[idx];
  $('#frontText').textContent=c.front; $('#backText').textContent=c.back;
  const cardDiv=$('#card'); cardDiv.classList.remove('flipped');
  if(c.img) cardDiv.style.backgroundImage=`url(${c.img})`; else cardDiv.style.background='white';
  $('#progressChip').textContent=`${study.i+1}/${study.order.length}`;
}

function flipCard(){ $('#card').classList.toggle('flipped'); }
$('#card').onclick=flipCard;

// Buttons
$('#btnMal').onclick=()=>mark(false);
$('#btnBien').onclick=()=>mark(true);

function mark(isGood){
  const s=findSet(currentSetId);
  const idx=study.order[study.i]; if(!isGood) study.wrong.push(idx);
  study.i++; showCard();
}

function endStudy(){
  $('#endButtons').classList.remove('hidden');
}

$('#btnAgainWrong').onclick=()=>{
  study.order=study.wrong.slice(); study.i=0; study.wrong=[]; $('#endButtons').classList.add('hidden'); showCard();
}
$('#btnRestartAll').onclick=()=>{
  const s=findSet(currentSetId); study.order=s.cards.map((_,i)=>i); study.i=0; study.wrong=[]; $('#endButtons').classList.add('hidden'); showCard();
}
$('#btnHomeEnd,#btnBackHome1,#btnBackHome2').forEach(b=>b.onclick=()=>showHome());

load(); renderSets(); showHome();
</script>
</body>
</html>

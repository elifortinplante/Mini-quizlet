<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mini-Quizlet ++</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,#6366f1,#ec4899,#f59e0b);color:white;min-height:100vh}
.btn{padding:.7rem 1rem;border-radius:9999px;font-weight:700}
.btn-primary{background:linear-gradient(90deg,#6366f1,#ec4899);color:white}
.btn-secondary{background:white;color:#4f46e5;border:2px solid #4f46e5}
.chip{background:#dbeafe;color:#1e3a8a;padding:.25rem .6rem;border-radius:9999px;font-size:.8rem;font-weight:700}
.input{width:100%;padding:.6rem .8rem;border-radius:14px;border:2px solid #e5e7eb;background:white;color:black}
.set-card{background:white;color:black;border-radius:20px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.18);display:flex;align-items:center;gap:10px;}
.mini-thumb{width:48px;height:48px;border-radius:12px;object-fit:cover;background:#eef}
.stage{perspective:1200px}
.card{width:100vw;height:100vh;border-radius:0;background:white;color:black;position:relative;transform-style:preserve-3d;transition:transform .6s, box-shadow .2s;box-shadow:0 12px 32px rgba(0,0,0,.25);user-select:none;display:flex;align-items:center;justify-content:center;text-align:center;overflow:hidden}
.card-face{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;backface-visibility:hidden;padding:20px;z-index:2}
.card-front,.card-back{width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;position:absolute;top:0;left:0}
.card-back{transform:rotateY(180deg)}
.flipped{transform:rotateY(180deg)}
.card-text{font-size:2rem;font-weight:700;color:white;text-shadow:0 2px 6px rgba(0,0,0,0.7);word-break:break-word;max-width:90%}
.bg-img{position:absolute;inset:0;background-size:cover;background-position:center;filter:brightness(0.6)}
.emoji-btn{position:absolute;top:50%;transform:translateY(-50%);font-size:3rem;user-select:none}
.emoji-left{left:20px}
.emoji-right{right:20px}
</style>
</head>
<body class="pb-20">
<header class="max-w-4xl mx-auto px-4 pt-5 flex items-center justify-between">
<div class="flex items-center gap-3">
<div class="w-11 h-11 rounded-2xl bg-white text-indigo-600 grid place-items-center font-extrabold">MQ+</div>
<div>
<h1 class="text-2xl font-extrabold drop-shadow">Mini-Quizlet ++</h1>
<p class="text-indigo-100 text-sm -mt-1">√âtudier en s‚Äôamusant ‚ú®</p>
</div>
</div>
<div class="flex items-center gap-2">
<button id="btnTheme" class="btn btn-secondary">üé® Th√®me</button>
<button id="btnNewSet" class="btn btn-primary">+ Nouveau set</button>
</div>
</header>

<main class="max-w-4xl mx-auto px-4 pt-4">
<section id="viewHome" class="space-y-4">
<div id="setsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
<p id="emptyMsg" class="text-center text-white/90 hidden">Aucun set. Cr√©e ton premier ‚ú®</p>
</section>

<section id="viewEditor" class="hidden">
<div class="flex items-center justify-between mb-3">
<button class="btn btn-secondary" id="btnBackHome1">‚Üê Accueil</button>
</div>
<div class="grid sm:grid-cols-2 gap-3 mb-3">
<div>
<label class="text-sm font-bold">Titre du set</label>
<input id="setTitle" class="input" placeholder="Ex: Vocabulaire anglais">
</div>
<div>
<label class="text-sm font-bold">Mati√®re</label>
<input id="setSubject" class="input" placeholder="Ex: Anglais">
</div>
<div>
<label class="text-sm font-bold">Image du set (URL)</label>
<input id="setImage" class="input" placeholder="Lien image">
</div>
</div>
<div class="flex items-center justify-between mb-2">
<h3 class="font-extrabold">Cartes</h3>
<button id="btnAddCard" class="btn btn-primary">+ Ajouter</button>
</div>
<div id="cardsList" class="space-y-3"></div>
<p id="noCardsMsg" class="hidden">Aucune carte.</p>
</section>

<section id="viewStudy" class="hidden">
<div class="text-center mb-2">
<div id="studySetTitle" class="text-xl font-extrabold"></div>
<div id="studySetSubject" class="text-lg font-bold"></div>
</div>

<div class="stage">
<div id="card" class="card">
<div class="bg-img" id="cardBg"></div>
<div class="card-face card-front">
<div class="card-text" id="frontText"></div>
</div>
<div class="card-face card-back">
<div class="card-text" id="backText"></div>
</div>
</div>
<button id="btnMal" class="emoji-btn emoji-left">‚ùå</button>
<button id="btnBien" class="emoji-btn emoji-right">‚úÖ</button>
</div>
<div class="text-center mt-4">
<div id="rewardMsg" class="text-yellow-300 font-extrabold"></div>
<div id="studyControls" class="hidden mt-5 flex flex-wrap items-center justify-center gap-2">
<button id="btnAgainWrong" class="btn btn-secondary">Reprendre erreurs</button>
<button id="btnRestartAll" class="btn btn-primary">Tout recommencer</button>
<button id="btnBackHome2" class="btn btn-secondary">Accueil</button>
</div>
</div>
</section>
</main>

<template id="tplSet">
<div class="set-card p-4 flex items-center gap-3">
<img class="mini-thumb"/>
<div class="flex-1">
<div class="font-extrabold text-black/90 set-title">Titre</div>
<div class="text-sm text-slate-500 set-subject">Mati√®re</div>
</div>
<div class="flex flex-col gap-2">
<button class="btn btn-primary btn-edit">Modifier</button>
<button class="btn btn-primary btn-play">Jouer</button>
<button class="btn btn-secondary btn-del">Supprimer</button>
</div>
</div>
</template>

<template id="tplCardRow">
<div class="set-card p-3">
<input class="input input-front" placeholder="Question">
<input class="input input-back" placeholder="R√©ponse">
<input class="input input-img" placeholder="URL image (facultatif)">
<button class="btn btn-secondary btn-del-card">üóëÔ∏è Carte</button>
</div>
</template>

<script>
const LS_KEY='mq_plus_sets';
let sets=[],currentSetId=null,study={i:0,wrong:[],score:0,finished:false,mode:'flash',order:[],startTime:0};

const $=(s)=>document.querySelector(s);
const $$=(s)=>document.querySelectorAll(s);
const uid=()=>Math.random().toString(36).slice(2,9);

function load(){try{sets=JSON.parse(localStorage.getItem(LS_KEY)||'[]');}catch{sets=[]}}
function save(){localStorage.setItem(LS_KEY,JSON.stringify(sets))}
function findSet(id){return sets.find(s=>s.id===id)}
function upsertSet(s){const i=sets.findIndex(x=>x.id===s.id);if(i>-1) sets[i]=s; else sets.push(s); save();}

const viewHome=$('#viewHome'), viewEditor=$('#viewEditor'), viewStudy=$('#viewStudy');
const setsGrid=$('#setsGrid'), emptyMsg=$('#emptyMsg');
const cardsList=$('#cardsList'), noCardsMsg=$('#noCardsMsg');
const setTitle=$('#setTitle'), setSubject=$('#setSubject'), setImage=$('#setImage');
const cardEl=$('#card'), frontText=$('#frontText'), backText=$('#backText'), cardBg=$('#cardBg');
const studySetTitle=$('#studySetTitle'), studySetSubject=$('#studySetSubject');
const btnMal=$('#btnMal'), btnBien=$('#btnBien'), studyControls=$('#studyControls');
const rewardMsg=$('#rewardMsg');

load();renderHome();

function renderHome(){
setsGrid.innerHTML='';
if(sets.length===0){emptyMsg.classList.remove('hidden'); return;}else{emptyMsg.classList.add('hidden');}
sets.forEach(s=>{
const tpl=$('#tplSet').content.cloneNode(true);
tpl.querySelector('.set-title').textContent=s.title||'Sans titre';
tpl.querySelector('.set-subject').textContent=s.subject||'';
tpl.querySelector('.mini-thumb').src=s.image||'';
tpl.querySelector('.btn-edit').onclick=()=>editSet(s.id);
tpl.querySelector('.btn-play').onclick=()=>playSet(s.id);
tpl.querySelector('.btn-del').onclick=()=>{sets=sets.filter(x=>x.id!==s.id);save();renderHome();}
setsGrid.appendChild(tpl);
});
}

function editSet(id=null){
viewHome.classList.add('hidden'); viewStudy.classList.add('hidden'); viewEditor.classList.remove('hidden');
currentSetId=id; let s=findSet(id)||{id:uid(),title:'',subject:'',image:'',cards:[]};
setTitle.value=s.title; setSubject.value=s.subject; setImage.value=s.image;
cardsList.innerHTML=''; if(!s.cards.length) noCardsMsg.classList.remove('hidden'); else noCardsMsg.classList.add('hidden');
s.cards.forEach(c=>addCardRow(c));
}

$('#btnNewSet').onclick=()=>editSet();

function addCardRow(c={front:'',back:'',img:''}){
const tpl=$('#tplCardRow').content.cloneNode(true);
tpl.querySelector('.input-front').value=c.front||'';
tpl.querySelector('.input-back').value=c.back||'';
tpl.querySelector('.input-img').value=c.img||'';
tpl.querySelector('.btn-del-card').onclick=function(){this.parentNode.remove();};
cardsList.appendChild(tpl);
noCardsMsg.classList.add('hidden');
}

$('#btnAddCard').onclick=()=>addCardRow();

$('#btnBackHome1').onclick=()=>renderHomeView();

function renderHomeView(){viewEditor.classList.add('hidden'); viewStudy.classList.add('hidden'); viewHome.classList.remove('hidden'); renderHome();}

$('#setTitle,#setSubject,#setImage').oninput=saveEditorChanges;
cardsList.addEventListener('input',saveEditorChanges);

function saveEditorChanges(){
let s=findSet(currentSetId)||{id:currentSetId||uid(),title:'',subject:'',image:'',cards:[]};
s.title=setTitle.value; s.subject=setSubject.value; s.image=setImage.value;
s.cards=[]; cardsList.querySelectorAll('.set-card').forEach(r=>{
s.cards.push({front:r.querySelector('.input-front').value,back:r.querySelector('.input-back').value,img:r.querySelector('.input-img').value});
});
upsertSet(s); renderHome();
}

function playSet(id){
let s=findSet(id); if(!s) return;
viewHome.classList.add('hidden'); viewEditor.classList.add('hidden'); viewStudy.classList.remove('hidden');
study={i:0,wrong:[],score:0,finished:false,mode:'flash',order:s.cards.map((_,i)=>i),startTime:Date.now()};
currentSetId=id; studySetTitle.textContent=s.title; studySetSubject.textContent=s.subject;
renderCard();
}

function renderCard(){
let s=findSet(currentSetId); if(!s) return;
if(study.i>=study.order.length){finishStudy(); return;}
let c=s.cards[study.order[study.i]];
frontText.textContent=c.front||'';
backText.textContent=c.back||'';
cardBg.style.background=c.img?`url(${c.img}) center/cover no-repeat`:'white';
cardEl.classList.remove('flipped');
studyControls.classList.add('hidden');
rewardMsg.textContent='';
}

cardEl.onclick=()=>cardEl.classList.toggle('flipped');

btnBien.onclick=()=>markCard(true);
btnMal.onclick=()=>markCard(false);

function markCard(correct){
let s=findSet(currentSetId);
let idx=study.order[study.i];
if(!correct) study.wrong.push(idx); else study.score++;
study.i++;
renderCard();
}

function finishStudy(){
study.finished=true; studyControls.classList.remove('hidden');
rewardMsg.textContent=`Score: ${study.score}/${study.order.length}`;
}

$('#btnAgainWrong').onclick=()=>{if(!study.wrong.length) return;study.order=study.wrong;study.i=0;study.score=0;study.wrong=[];renderCard();}
$('#btnRestartAll').onclick=()=>playSet(currentSetId);
$('#btnBackHome2').onclick=()=>renderHomeView();
</script>
</body>
</html>

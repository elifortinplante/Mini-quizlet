<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Quizlet ++</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,#6366f1,#ec4899,#f59e0b);color:white;min-height:100vh;display:flex;flex-direction:column;align-items:center;}
  .btn{padding:.7rem 1rem;border-radius:9999px;font-weight:700}
  .btn-primary{background:linear-gradient(90deg,#6366f1,#ec4899);color:white}
  .btn-secondary{background:white;color:#4f46e5;border:2px solid #4f46e5}
  .chip{background:#dbeafe;color:#1e3a8a;padding:.25rem .6rem;border-radius:9999px;font-size:.8rem;font-weight:700}
  .input{width:100%;padding:.6rem .8rem;border-radius:14px;border:2px solid #e5e7eb;background:white;color:black}
  .set-card{background:white;color:black;border-radius:20px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.18);display:flex;align-items:center;gap:8px;}
  .mini-thumb{width:48px;height:48px;border-radius:12px;object-fit:cover;background:#eef}
  .stage{position:relative;width:100vw;height:70vh;display:flex;justify-content:center;align-items:center;}
  .card{width:100%;height:100%;border-radius:16px;background:white;color:black;position:relative;display:flex;justify-content:center;align-items:center;flex-direction:column;box-shadow:0 12px 32px rgba(0,0,0,.25);overflow:hidden;text-align:center;}
  .card img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:0;}
  .card-text{position:relative;z-index:1;padding:16px;background:rgba(0,0,0,0.5);border-radius:12px;max-width:90%;word-wrap:break-word;}
  .emoji-btn{position:absolute;top:50%;transform:translateY(-50%);font-size:2.5rem;cursor:pointer;}
  .emoji-left{left:10%;}
  .emoji-right{right:10%;}
  .hidden{display:none;}
</style>
</head>
<body>
<header class="w-full max-w-4xl flex justify-between items-center p-4">
  <h1 class="text-2xl font-extrabold">Mini Quizlet ++</h1>
  <button id="btnNewSet" class="btn btn-primary">+ Nouveau set</button>
</header>
<main class="w-full max-w-4xl p-4 flex flex-col gap-4">
  <section id="viewHome"></section>
  <section id="viewEditor" class="hidden"></section>
  <section id="viewStudy" class="hidden">
    <div class="stage">
      <div id="card" class="card">
        <img id="cardImg" src="" alt="">
        <div class="card-text" id="cardText"></div>
        <div id="btnMal" class="emoji-btn emoji-left">❌</div>
        <div id="btnBien" class="emoji-btn emoji-right">✅</div>
      </div>
    </div>
    <div id="endControls" class="flex justify-center gap-2 hidden">
      <button id="btnRestartAll" class="btn btn-primary">Tout recommencer</button>
      <button id="btnAgainWrong" class="btn btn-secondary">Reprendre erreurs</button>
      <button id="btnHome" class="btn btn-secondary">Accueil</button>
    </div>
  </section>
</main>
<script>
const LS_KEY='mq_plus_sets';
let sets=[];
let currentSetId=null;
let study={i:0,wrong:[],score:0,finished:false,currentCard:null};

const $=(s)=>document.querySelector(s);
const uid=()=>Math.random().toString(36).slice(2,9);

function load(){sets=JSON.parse(localStorage.getItem(LS_KEY)||'[]');}
function save(){localStorage.setItem(LS_KEY,JSON.stringify(sets));}
function findSet(id){return sets.find(s=>s.id===id);}
function upsertSet(s){const i=sets.findIndex(x=>x.id===s.id);i>-1?sets[i]=s:sets.push(s);save();}

// Home
function renderHome(){
  const view=$('#viewHome'); view.innerHTML='';
  sets.forEach(s=>{
    const div=document.createElement('div'); div.className='set-card';
    const img=document.createElement('img'); img.className='mini-thumb'; img.src=s.img||'';
    const title=document.createElement('div'); title.textContent=s.title;
    const subject=document.createElement('div'); subject.textContent=s.subject;
    const btnPlay=document.createElement('button'); btnPlay.textContent='Jouer'; btnPlay.onclick=()=>startStudy(s.id);
    div.append(img,title,subject,btnPlay);
    view.appendChild(div);
  });
}

$('#btnNewSet').onclick=()=>{
  const s={id:uid(),title:'Nouveau set',subject:'',cards:[]};
  upsertSet(s); renderHome();
};

function startStudy(setId){
  const s=findSet(setId); if(!s||!s.cards.length){alert('Ajoute des cartes !');return;}
  currentSetId=setId; study.i=0; study.wrong=[]; study.finished=false;
  $('#viewHome').classList.add('hidden'); $('#viewStudy').classList.remove('hidden'); $('#endControls').classList.add('hidden');
  showCard(s.cards[study.i]);
}

function showCard(c){
  study.currentCard=c;
  $('#cardImg').src=c.img||'';
  $('#cardText').textContent=c.front;
}

$('#btnMal').onclick=()=>markCard(false);
$('#btnBien').onclick=()=>markCard(true);

function markCard(ok){
  if(ok){study.score++;} else {study.wrong.push(study.currentCard);}
  const s=findSet(currentSetId);
  study.i++;
  if(study.i>=s.cards.length){
    study.finished=true; $('#endControls').classList.remove('hidden');
  } else showCard(s.cards[study.i]);
}

$('#btnRestartAll').onclick=()=>startStudy(currentSetId);
$('#btnAgainWrong').onclick=()=>{
  if(!study.wrong.length){alert('Aucune erreur à reprendre.');return;}
  const s=findSet(currentSetId);
  s.cards=study.wrong; study.i=0; study.wrong=[]; study.finished=false; $('#endControls').classList.add('hidden'); showCard(s.cards[0]);
};
$('#btnHome').onclick=()=>{ $('#viewStudy').classList.add('hidden'); $('#viewHome').classList.remove('hidden'); renderHome();};

load(); renderHome();
</script>
</body>
</html>

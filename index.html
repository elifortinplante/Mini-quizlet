<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Quizlet ++</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,#6366f1,#ec4899,#34d399);color:white;min-height:100vh;}
  .btn{padding:.7rem 1rem;border-radius:9999px;font-weight:700;}
  .btn-primary{background:linear-gradient(90deg,#6366f1,#ec4899);color:white;}
  .btn-secondary{background:white;color:#4f46e5;border:2px solid #4f46e5;}
  .chip{background:#dbeafe;color:#1e3a8a;padding:.25rem .6rem;border-radius:9999px;font-size:.8rem;font-weight:700;}
  .input{width:100%;padding:.6rem .8rem;border-radius:14px;border:2px solid #e5e7eb;background:white;color:black;}
  .set-card{background:white;color:black;border-radius:20px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.18);display:flex;align-items:center;gap:8px;}
  .mini-thumb{width:48px;height:48px;border-radius:12px;object-fit:cover;background:#eef;}
  .stage{perspective:1200px;}
  .card{width:100%;max-width:90vw;height:80vh;border-radius:28px;position:relative;transform-style:preserve-3d;transition:transform .6s, box-shadow .2s;box-shadow:0 12px 32px rgba(0,0,0,.25);user-select:none;margin-inline:auto;display:flex;align-items:center;justify-content:center;text-align:center;overflow:hidden;}
  .card-face{position:absolute;inset:0;padding:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;backface-visibility:hidden;font-size:1.2rem;font-weight:bold;}
  .card-front{transform:rotateY(0);background:white;color:black;}
  .card-back{transform:rotateY(180deg);background:white;color:black;}
  .flipped{transform:rotateY(180deg);}
  .card img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:0;}
  .card-text{position:relative;z-index:1;color:black;text-shadow:0 0 6px rgba(255,255,255,.7);}
  .editor-row{display:flex;flex-direction:column;gap:4px;}
</style>
</head>
<body class="pb-10">
<header class="max-w-4xl mx-auto px-4 pt-5 flex items-center justify-between">
  <div class="flex items-center gap-3">
    <div class="w-11 h-11 rounded-2xl bg-white text-indigo-600 grid place-items-center font-extrabold">MQ+</div>
    <div>
      <h1 class="text-2xl font-extrabold drop-shadow">Mini-Quizlet ++</h1>
      <p class="text-indigo-100 text-sm -mt-1">√âtudier en s‚Äôamusant ‚ú®</p>
    </div>
  </div>
  <div class="flex items-center gap-2">
    <button id="btnNewSet" class="btn btn-primary">+ Nouveau set</button>
  </div>
</header>

<main class="max-w-4xl mx-auto px-4 pt-4">
  <!-- HOME -->
  <section id="viewHome" class="space-y-4">
    <div id="setsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
    <p id="emptyMsg" class="text-center text-white/90 hidden">Aucun set. Cr√©e ton premier ‚ú®</p>
  </section>

  <!-- EDITOR -->
  <section id="viewEditor" class="hidden">
    <button class="btn btn-secondary mb-3" id="btnBackHome1">‚Üê Accueil</button>
    <div class="grid gap-3 mb-3">
      <input id="setTitle" class="input" placeholder="Titre du set">
      <input id="setSubject" class="input" placeholder="Mati√®re">
      <input id="setImage" class="input" placeholder="URL image du set">
    </div>
    <div class="flex items-center justify-between mb-2">
      <h3 class="font-extrabold">Cartes</h3>
      <button id="btnAddCard" class="btn btn-primary">+ Ajouter</button>
    </div>
    <div id="cardsList" class="space-y-3"></div>
  </section>

  <!-- STUDY -->
  <section id="viewStudy" class="hidden">
    <button class="btn btn-secondary mb-3" id="btnBackHome2">‚Üê Accueil</button>
    <div class="text-center mb-2">
      <div id="studySetTitle" class="text-xl font-extrabold"></div>
      <div id="studySetSubject" class="text-sm font-bold text-indigo-100"></div>
    </div>
    <div class="stage mt-3">
      <div id="card" class="card">
        <img id="cardImg" src="" alt="">
        <div class="card-face card-front"><div class="card-text" id="frontText"></div></div>
        <div class="card-face card-back"><div class="card-text" id="backText"></div></div>
      </div>
    </div>
    <div class="mt-5 flex justify-center gap-6">
      <button id="btnWrong" class="btn btn-secondary">‚ùå</button>
      <button id="btnRight" class="btn btn-primary">‚úÖ</button>
    </div>
    <div class="text-center mt-4">
      <span id="progressChip" class="chip"></span>
      <span id="xpChip" class="chip"></span>
    </div>
  </section>
</main>

<template id="tplSet">
  <div class="set-card p-4">
    <img class="mini-thumb" />
    <div class="flex-1">
      <div class="font-extrabold text-black/90 set-title"></div>
      <div class="text-sm text-slate-500 set-subject"></div>
    </div>
    <div class="flex flex-col gap-2">
      <button class="btn btn-primary btn-edit">Modifier</button>
      <button class="btn btn-primary btn-play">Jouer</button>
      <button class="btn btn-secondary btn-del">Supprimer</button>
    </div>
  </div>
</template>

<template id="tplCardRow">
  <div class="set-card p-3 editor-row">
    <input class="input input-front" placeholder="Question">
    <input class="input input-back" placeholder="R√©ponse">
    <input class="input input-img" placeholder="URL image (facultatif)">
    <button class="btn btn-secondary btn-del-card">üóëÔ∏è Supprimer carte</button>
  </div>
</template>

<script>
// --- Data & helpers ---
const LS_KEY='mq_plus_sets';
let sets=[], currentSetId=null, study={order:[],i:0,wrong:[],score:0,finished:false,startTime:0};

const $=(s)=>document.querySelector(s);
const uid=()=>Math.random().toString(36).slice(2,9);
function load(){try{sets=JSON.parse(localStorage.getItem(LS_KEY)||'[]');}catch{sets=[]}}
function save(){localStorage.setItem(LS_KEY,JSON.stringify(sets));}
function findSet(id){return sets.find(s=>s.id===id)}
function upsertSet(s){const i=sets.findIndex(x=>x.id===s.id); i>-1? sets[i]=s: sets.push(s); save();}

// --- Views ---
const viewHome=$('#viewHome'), viewEditor=$('#viewEditor'), viewStudy=$('#viewStudy');
const setsGrid=$('#setsGrid'), emptyMsg=$('#emptyMsg');
function showHome(){viewHome.classList.remove('hidden');viewEditor.classList.add('hidden');viewStudy.classList.add('hidden');renderHome();}
function showEditor(){viewHome.classList.add('hidden');viewEditor.classList.remove('hidden');viewStudy.classList.add('hidden');}
function showStudy(){viewHome.classList.add('hidden');viewEditor.classList.add('hidden');viewStudy.classList.remove('hidden');}

// --- Home ---
function renderHome(){
  setsGrid.innerHTML='';
  if(!sets.length){emptyMsg.classList.remove('hidden');return}else{emptyMsg.classList.add('hidden')}
  const tpl=$('#tplSet');
  sets.forEach(s=>{
    const node=tpl.content.cloneNode(true);
    node.querySelector('.mini-thumb').src=s.image||'';
    node.querySelector('.set-title').textContent=s.title;
    node.querySelector('.set-subject').textContent=s.subject;
    node.querySelector('.btn-edit').onclick=()=>{editSet(s.id);}
    node.querySelector('.btn-play').onclick=()=>{startStudy(s.id);}
    node.querySelector('.btn-del').onclick=()=>{if(confirm('Supprimer ce set ?')){sets=sets.filter(x=>x.id!==s.id);save();renderHome()}}
    setsGrid.appendChild(node);
  })
}

// --- Editor ---
$('#btnNewSet').onclick=()=>{
  const s={id:uid(),title:'Nouveau set',subject:'',image:'',cards:[]};
  sets.push(s);save();editSet(s.id);
}
function editSet(id){
  currentSetId=id;
  const s=findSet(id);showEditor();
  $('#setTitle').value=s.title;
  $('#setSubject').value=s.subject;
  $('#setImage').value=s.image;
  $('#cardsList').innerHTML='';
  s.cards.forEach(addCardRow);
}
$('#btnBackHome1').onclick=()=>showHome();
$('#setTitle').oninput=e=>{findSet(currentSetId).title=e.target.value;save();renderHome();}
$('#setSubject').oninput=e=>{findSet(currentSetId).subject=e.target.value;save();}
$('#setImage').oninput=e=>{findSet(currentSetId).image=e.target.value;save();renderHome();}
$('#btnAddCard').onclick=()=>{const s=findSet(currentSetId);const c={id:uid(),q:'',a:'',img:''};s.cards.push(c);save();addCardRow(c);}
function addCardRow(c){
  const tpl=$('#tplCardRow');
  const node=tpl.content.cloneNode(true);
  const row=node.querySelector('.editor-row');
  const front=row.querySelector('.input-front'); front.value=c.q;
  const back=row.querySelector('.input-back'); back.value=c.a;
  const img=row.querySelector('.input-img'); img.value=c.img;
  front.oninput=e=>{c.q=e.target.value;save();}
  back.oninput=e=>{c.a=e.target.value;save();}
  img.oninput=e=>{c.img=e.target.value;save();}
  row.querySelector('.btn-del-card').onclick=()=>{const s=findSet(currentSetId);s.cards=s.cards.filter(x=>x.id!==c.id);save();row.remove();}
  $('#cardsList').appendChild(node);
}

// --- Study ---
$('#btnBackHome2').onclick=()=>showHome();
const card=$('#card'), cardImg=$('#cardImg'), frontText=$('#frontText'), backText=$('#backText');
const btnRight=$('#btnRight'), btnWrong=$('#btnWrong'), progressChip=$('#progressChip'), xpChip=$('#xpChip');

function startStudy(id){
  const s=findSet(id);
  if(!s.cards.length){alert('Pas de cartes dans ce set');return}
  currentSetId=id;
  study.order=s.cards.map((c,i)=>i); study.i=0; study.wrong=[]; study.score=0; study.finished=false; study.startTime=Date.now();
  showStudy(); renderCard();
}

function renderCard(){
  const s=findSet(currentSetId); 
  if(study.i>=study.order.length){study.finished=true;updateChips();return}
  const c=s.cards[study.order[study.i]];
  cardImg.src=c.img||''; // si vide, fond blanc
  frontText.textContent=c.q; backText.textContent=c.a;
  card.classList.remove('flipped');
  updateChips();
}

card.onclick=()=>{card.classList.toggle('flipped');}
function mark(right){
  if(!study.finished){
    if(!right) study.wrong.push(study.order[study.i]);
    else study.score++;
    study.i++; renderCard();
  }
}
btnRight.onclick=()=>mark(true);
btnWrong.onclick=()=>mark(false);

function updateChips(){
  progressChip.textContent=`${study.i}/${study.order.length}`;
  xpChip.textContent=`Score: ${study.score}`;
}

load();renderHome();
</script>
</body>
</html>

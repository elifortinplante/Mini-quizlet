<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flashcards App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #a18cd1, #fbc2eb, #84fab0);
      background-size: 400% 400%;
      animation: gradientBG 10s ease infinite;
    }

    @keyframes gradientBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    .hidden { display: none; }
    .container { padding: 20px; text-align: center; }
    h1 { color: white; }

    .set-card {
      background: white;
      border-radius: 15px;
      padding: 15px;
      margin: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      display: inline-block;
      width: 200px;
    }
    .set-card img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 10px;
    }
    .button {
      background: #6a11cb;
      color: white;
      padding: 10px 15px;
      margin: 5px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    .button:hover {
      background: #2575fc;
    }

    .flashcard {
      width: 300px;
      height: 400px;
      perspective: 1000px;
      margin: 20px auto;
      position: relative;
    }
    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      text-align: center;
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }
    .card-inner.flipped {
      transform: rotateY(180deg);
    }
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 15px;
      font-size: 1.2em;
      background: white;
    }
    .card-back {
      transform: rotateY(180deg);
    }
    .flashcard img {
      max-width: 90%;
      max-height: 200px;
      margin-bottom: 15px;
      border-radius: 10px;
      object-fit: contain;
    }

    .answer-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }
    .answer-buttons button {
      width: 45%;
    }
  </style>
</head>
<body>
  <div id="home" class="container">
    <h1>Mes Flashcards</h1>
    <button class="button" onclick="showNewSetForm()">Nouveau set</button>
    <div id="setsContainer"></div>
  </div>

  <div id="newSet" class="container hidden">
    <h2>Nouveau Set</h2>
    <input id="setTitle" placeholder="Titre du set"><br><br>
    <input id="setSubject" placeholder="Matière"><br><br>
    <input id="setImage" placeholder="URL de l'image (optionnel)"><br><br>
    <button class="button" onclick="createSet()">Créer</button>
    <button class="button" onclick="goHome()">Annuler</button>
  </div>

  <div id="editSet" class="container hidden">
    <h2 id="editSetTitle"></h2>
    <div id="cardsContainer"></div>
    <button class="button" onclick="addCard()">Ajouter une carte</button><br><br>
    <button class="button" onclick="saveSet()">Sauvegarder</button>
    <button class="button" onclick="goHome()">Retour</button>
  </div>

  <div id="playSet" class="container hidden">
    <h2 id="playSetTitle"></h2>
    <div id="flashcard" class="flashcard" onclick="flipCard()">
      <div id="cardInner" class="card-inner">
        <div id="cardFront" class="card-front"></div>
        <div id="cardBack" class="card-back"></div>
      </div>
    </div>
    <div class="answer-buttons">
      <button class="button" onclick="markAnswer(true)">Bien</button>
      <button class="button" onclick="markAnswer(false)">Mal</button>
    </div>
  </div>

  <script>
    let sets = JSON.parse(localStorage.getItem("flashSets")) || [];
    let currentSetIndex = null;
    let currentCardIndex = 0;
    let score = 0;

    function saveToStorage() {
      localStorage.setItem("flashSets", JSON.stringify(sets));
    }

    function showNewSetForm() {
      document.getElementById("home").classList.add("hidden");
      document.getElementById("newSet").classList.remove("hidden");
    }

    function goHome() {
      document.getElementById("home").classList.remove("hidden");
      document.getElementById("newSet").classList.add("hidden");
      document.getElementById("editSet").classList.add("hidden");
      document.getElementById("playSet").classList.add("hidden");
      displaySets();
    }

    function createSet() {
      let title = document.getElementById("setTitle").value;
      let subject = document.getElementById("setSubject").value;
      let image = document.getElementById("setImage").value;
      if (!title) return;
      sets.push({title, subject, image, cards: []});
      saveToStorage();
      goHome();
    }

    function displaySets() {
      let container = document.getElementById("setsContainer");
      container.innerHTML = "";
      sets.forEach((set, index) => {
        let div = document.createElement("div");
        div.className = "set-card";
        div.innerHTML = `
          <img src="${set.image || 'https://via.placeholder.com/200x120?text=Aucune+image'}">
          <h3>${set.title}</h3>
          <p>${set.subject}</p>
          <button class="button" onclick="editSet(${index})">Modifier</button>
          <button class="button" onclick="playSet(${index})">Jouer</button>
          <button class="button" onclick="deleteSet(${index})">Supprimer</button>
        `;
        container.appendChild(div);
      });
    }

    function editSet(index) {
      currentSetIndex = index;
      document.getElementById("home").classList.add("hidden");
      document.getElementById("editSet").classList.remove("hidden");
      document.getElementById("editSetTitle").innerText = sets[index].title;
      displayCards();
    }

    function displayCards() {
      let container = document.getElementById("cardsContainer");
      container.innerHTML = "";
      sets[currentSetIndex].cards.forEach((card, idx) => {
        let div = document.createElement("div");
        div.innerHTML = `
          <input placeholder="Question" value="${card.q}"><br>
          <input placeholder="Réponse" value="${card.a}"><br>
          <input placeholder="Image URL (optionnel)" value="${card.img || ''}"><br><br>
        `;
        container.appendChild(div);
      });
    }

    function addCard() {
      sets[currentSetIndex].cards.push({q:"", a:"", img:""});
      displayCards();
    }

    function saveSet() {
      let container = document.getElementById("cardsContainer").children;
      sets[currentSetIndex].cards = [];
      for (let div of container) {
        let inputs = div.querySelectorAll("input");
        sets[currentSetIndex].cards.push({
          q: inputs[0].value,
          a: inputs[1].value,
          img: inputs[2].value
        });
      }
      saveToStorage();
      goHome();
    }

    function playSet(index) {
      currentSetIndex = index;
      currentCardIndex = 0;
      score = 0;
      document.getElementById("home").classList.add("hidden");
      document.getElementById("playSet").classList.remove("hidden");
      document.getElementById("playSetTitle").innerText = sets[index].title;
      showCard();
    }

    function showCard() {
      let card = sets[currentSetIndex].cards[currentCardIndex];
      document.getElementById("cardFront").innerHTML = `
        ${card.img ? `<img src="${card.img}">` : ""}
        <p>${card.q}</p>
      `;
      document.getElementById("cardBack").innerHTML = `
        ${card.img ? `<img src="${card.img}">` : ""}
        <p>${card.a}</p>
      `;
      document.getElementById("cardInner").classList.remove("flipped");
    }

    function flipCard() {
      document.getElementById("cardInner").classList.toggle("flipped");
    }

    function markAnswer(correct) {
      if (correct) score++;
      currentCardIndex++;
      if (currentCardIndex >= sets[currentSetIndex].cards.length) {
        alert("Fini ! Score : " + score + "/" + sets[currentSetIndex].cards.length);
        goHome();
      } else {
        showCard();
      }
    }

    function deleteSet(index) {
      sets.splice(index, 1);
      saveToStorage();
      displaySets();
    }

    displaySets();
  </script>
</body>
</html>

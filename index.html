<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Quizlet ++</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,#6366f1,#ec4899,#10b981);color:white;min-height:100vh;}
.btn{padding:.7rem 1rem;border-radius:9999px;font-weight:700}
.btn-primary{background:linear-gradient(90deg,#6366f1,#ec4899);color:white}
.btn-secondary{background:white;color:#4f46e5;border:2px solid #4f46e5}
.chip{background:#dbeafe;color:#1e3a8a;padding:.25rem .6rem;border-radius:9999px;font-size:.8rem;font-weight:700}
.input{width:100%;padding:.6rem .8rem;border-radius:14px;border:2px solid #e5e7eb;background:white;color:black}
.set-card{background:white;color:black;border-radius:20px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.18);position:relative}
.mini-thumb{width:48px;height:48px;border-radius:12px;object-fit:cover;background:#eef}
/* Carte √©tude */
.stage{perspective:1200px;margin-top:20px;position:relative}
.card{width:100%;height:400px;border-radius:28px;background:white;color:black;position:relative;transform-style:preserve-3d;transition:transform .6s;display:flex;align-items:center;justify-content:center;font-size:1.5rem;text-align:center;overflow:hidden}
.card-face{position:absolute;inset:0;backface-visibility:hidden;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;padding:20px;}
.card-front{transform:rotateY(0deg);background:white;color:black;}
.card-back{transform:rotateY(180deg);background:white;color:black;}
.flipped{transform:rotateY(180deg);}
.card img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:0;}
.card .text{position:relative;z-index:2;background:rgba(255,255,255,0.7);padding:10px;border-radius:10px;word-wrap:break-word;}
#btnMal{position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:3rem;}
#btnBien{position:absolute;right:10px;top:50%;transform:translateY(-50%);font-size:3rem;}
#endControls{display:none;margin-top:20px;}
</style>
</head>
<body class="pb-20">
<header class="max-w-4xl mx-auto px-4 pt-5 flex items-center justify-between">
<div class="flex items-center gap-3">
  <div class="w-11 h-11 rounded-2xl bg-white text-indigo-600 grid place-items-center font-extrabold">MQ+</div>
  <div>
    <h1 class="text-2xl font-extrabold drop-shadow">Mini-Quizlet ++</h1>
    <p class="text-indigo-100 text-sm -mt-1">√âtudier en s‚Äôamusant ‚ú®</p>
  </div>
</div>
<div class="flex items-center gap-2">
  <button id="btnTheme" class="btn btn-secondary">üé® Th√®me</button>
  <button id="btnNewSet" class="btn btn-primary">+ Nouveau set</button>
</div>
</header>

<main class="max-w-4xl mx-auto px-4 pt-4">
<!-- HOME -->
<section id="viewHome" class="space-y-4">
  <div id="setsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
  <p id="emptyMsg" class="text-center text-white/90 hidden">Aucun set. Cr√©e ton premier ‚ú®</p>
</section>

<!-- EDITOR -->
<section id="viewEditor" class="hidden">
<div class="flex items-center justify-between mb-3">
  <button class="btn btn-secondary" id="btnBackHome1">‚Üê Accueil</button>
</div>
<div class="grid sm:grid-cols-2 gap-3 mb-3">
  <div>
    <label class="text-sm font-bold">Titre du set</label>
    <input id="setTitle" class="input" placeholder="Ex: Vocabulaire anglais">
  </div>
  <div>
    <label class="text-sm font-bold">Mati√®re</label>
    <input id="setSubject" class="input" placeholder="Ex: Anglais">
  </div>
</div>
<div class="mb-3">
<label class="text-sm font-bold">Image du set (URL)</label>
<input id="setImageURL" class="input" placeholder="https://...">
</div>
<div class="flex items-center justify-between mb-2">
  <h3 class="font-extrabold">Cartes</h3>
  <button id="btnAddCard" class="btn btn-primary">+ Ajouter</button>
</div>
<div id="cardsList" class="space-y-3"></div>
<p id="noCardsMsg" class="hidden">Aucune carte.</p>
</section>

<!-- STUDY -->
<section id="viewStudy" class="hidden">
<div class="flex items-center justify-between mb-2">
  <button class="btn btn-secondary" id="btnBackHome2">‚Üê Accueil</button>
  <div class="flex items-center gap-2">
    <span id="xpChip" class="chip">XP: 0</span>
    <span id="streakChip" class="chip">üî• 0</span>
    <span id="progressChip" class="chip">0/0</span>
  </div>
</div>
<div class="text-center mb-2">
  <div id="studySetTitle" class="text-xl font-extrabold"></div>
  <div id="studySetSubject" class="text-sm"></div>
</div>

<div class="stage">
  <div id="card" class="card">
    <img id="cardImg" src="" alt="">
    <div class="card-face card-front"><div class="text" id="frontText"></div></div>
    <div class="card-face card-back"><div class="text" id="backText"></div></div>
  </div>
  <button id="btnMal">‚ùå</button>
  <button id="btnBien">‚úÖ</button>
</div>

<div id="endControls" class="text-center">
  <div id="rewardMsg" class="text-yellow-300 font-extrabold mb-2"></div>
  <button id="btnRetryWrong" class="btn btn-primary mb-1">Recommencer erreurs</button>
  <button id="btnRetryAll" class="btn btn-primary mb-1">Recommencer tout</button>
  <button id="btnHomeEnd" class="btn btn-secondary">Accueil</button>
</div>
</section>
</main>

<!-- Templates -->
<template id="tplSet">
<div class="set-card p-4 flex items-center gap-3">
<img class="mini-thumb"/>
<div class="flex-1">
  <div class="font-extrabold text-black/90 set-title">Titre</div>
  <div class="text-sm text-slate-500 set-subject">Mati√®re</div>
</div>
<div class="flex flex-col gap-2">
  <button class="btn btn-primary btn-edit">Modifier</button>
  <button class="btn btn-primary btn-play">Jouer</button>
  <button class="btn btn-secondary btn-del">Supprimer</button>
</div>
</div>
</template>

<template id="tplCardRow">
<div class="set-card p-3">
  <input class="input input-front" placeholder="Question">
  <input class="input input-back" placeholder="R√©ponse">
  <input class="input input-img" placeholder="Image URL">
  <button class="btn btn-secondary btn-del-card">üóëÔ∏è Supprimer</button>
</div>
</template>

<script>
// --- Donn√©es ---
const LS_KEY='mq_plus_sets';
let sets=[]; 
let currentSetId=null;
let study={i:0,order:[],wrong:[],score:0,mode:'flash'};

const $=(s)=>document.querySelector(s);
const $$=(s)=>document.querySelectorAll(s);
const uid=()=>Math.random().toString(36).slice(2,9);

function load(){try{sets=JSON.parse(localStorage.getItem(LS_KEY)||'[]')}catch{sets=[]}}
function save(){localStorage.setItem(LS_KEY,JSON.stringify(sets))}

// --- Affichage Sets ---
function renderSets(){
  const grid=$('#setsGrid'); grid.innerHTML='';
  if(!sets.length){$('#emptyMsg').classList.remove('hidden'); return;} else $('#emptyMsg').classList.add('hidden');
  sets.forEach(s=>{
    const tpl=document.getElementById('tplSet').content.cloneNode(true);
    tpl.querySelector('.set-title').textContent=s.title;
    tpl.querySelector('.set-subject').textContent=s.subject;
    tpl.querySelector('.mini-thumb').src=s.image||'';
    tpl.querySelector('.btn-edit').onclick=()=>editSet(s.id);
    tpl.querySelector('.btn-play').onclick=()=>startStudy(s.id);
    tpl.querySelector('.btn-del').onclick=()=>{if(confirm('Supprimer ce set?')){sets=sets.filter(x=>x.id!==s.id);save();renderSets();}};
    grid.appendChild(tpl);
  });
}

// --- √âditeur ---
function editSet(id=null){
  currentSetId=id; $('#viewHome').classList.add('hidden'); $('#viewEditor').classList.remove('hidden');
  if(id){ 
    const s=sets.find(x=>x.id===id); 
    $('#setTitle').value=s.title;
    $('#setSubject').value=s.subject;
    $('#setImageURL').value=s.image||'';
    renderCards(s.cards||[]);
  } else {
    $('#setTitle').value=''; $('#setSubject').value=''; $('#setImageURL').value=''; renderCards([]);
  }
}

function renderCards(cards){
  const list=$('#cardsList'); list.innerHTML='';
  if(!cards?.length){$('#noCardsMsg').classList.remove('hidden'); return;} else $('#noCardsMsg').classList.add('hidden');
  cards.forEach(c=>{
    const tpl=document.getElementById('tplCardRow').content.cloneNode(true);
    tpl.querySelector('.input-front').value=c.front;
    tpl.querySelector('.input-back').value=c.back;
    tpl.querySelector('.input-img').value=c.img||'';
    tpl.querySelector('.btn-del-card').onclick=()=>{cards.splice(cards.indexOf(c),1);saveCurrentSet();renderCards(cards);};
    tpl.querySelectorAll('input').forEach(inp=>{
      inp.oninput=()=>{c.front=tpl.querySelector('.input-front').value; c.back=tpl.querySelector('.input-back').value; c.img=tpl.querySelector('.input-img').value; saveCurrentSet();}
    });
    list.appendChild(tpl);
  });
}

function saveCurrentSet(){
  if(!currentSetId){
    const newSet={id:uid(),title:$('#setTitle').value,subject:$('#setSubject').value,image:$('#setImageURL').value,cards:[]};
    sets.push(newSet); currentSetId=newSet.id;
  } else {
    const s=sets.find(x=>x.id===currentSetId);
    s.title=$('#setTitle').value; s.subject=$('#setSubject').value; s.image=$('#setImageURL').value;
  }
  save(); renderSets();
}

// --- Ajouter carte ---
$('#btnAddCard').onclick=()=>{
  const s=sets.find(x=>x.id===currentSetId);
  s.cards.push({front:'',back:'',img:''}); saveCurrentSet(); renderCards(s.cards);
};

// --- Navigation ---
$('#btnNewSet').onclick=()=>editSet();
$('#btnBackHome1').onclick=()=>{$('#viewEditor').classList.add('hidden');$('#viewHome').classList.remove('hidden');renderSets();}
$('#btnBackHome2').onclick=()=>{$('#viewStudy').classList.add('hidden');$('#viewHome').classList.remove('hidden');renderSets();}

// --- √âtude ---
function startStudy(id){
  const s=sets.find(x=>x.id===id); 
  currentSetId=id; study.i=0; study.order=s.cards.map((_,i)=>i); study.wrong=[]; study.score=0;
  $('#studySetTitle').textContent=s.title; $('#studySetSubject').textContent=s.subject;
  $('#viewHome').classList.add('hidden'); $('#viewStudy').classList.remove('hidden');
  $('#endControls').style.display='none';
  renderStudyCard();
}

function renderStudyCard(){
  const s=sets.find(x=>x.id===currentSetId); if(!s.cards.length)return;
  const c=s.cards[study.order[study.i]]; if(!c)return;
  const img=$('#cardImg'); img.src=c.img||''; img.style.background=c.img?'':'white';
  $('#frontText').textContent=c.front;
  $('#backText').textContent=c.back;
  $('#card').classList.remove('flipped');
  $('#progressChip').textContent=`${study.i+1}/${s.cards.length}`;
}

$('#card').onclick=()=>{$('#card').classList.toggle('flipped');};

$('#btnBien').onclick=()=>{nextCard(true)};
$('#btnMal').onclick=()=>{nextCard(false)};

function nextCard(correct){
  const s=sets.find(x=>x.id===currentSetId); 
  if(!s.cards.length) return;
  if(!correct) study.wrong.push(study.order[study.i]);
  study.i++;
  if(study.i>=study.order.length){
    // FIN DU SET
    $('#rewardMsg').textContent=`Set termin√© ! Score: ${s.cards.length - study.wrong.length}/${s.cards.length}`;
    $('#endControls').style.display='block';
    return;
  }
  renderStudyCard();
}

// --- Boutons fin de set ---
$('#btnRetryWrong').onclick=()=>{
  const s=sets.find(x=>x.id===currentSetId);
  if(!study.wrong.length)return;
  study.order=study.wrong.slice();
  study.i=0;
  study.wrong=[];
  $('#endControls').style.display='none';
  renderStudyCard();
};
$('#btnRetryAll').onclick=()=>{
  const s=sets.find(x=>x.id===currentSetId);
  study.order=s.cards.map((_,i)=>i);
  study.i=0;
  study.wrong=[];
  $('#endControls').style.display='none';
  renderStudyCard();
};
$('#btnHomeEnd').onclick=()=>{
  $('#viewStudy').classList.add('hidden');$('#viewHome').classList.remove('hidden');renderSets();
};

// --- Init ---
load(); renderSets();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Quizlet ++</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,#6366f1,#ec4899,#f59e0b);color:white;min-height:100vh}
.btn{padding:.7rem 1rem;border-radius:9999px;font-weight:700}
.btn-primary{background:linear-gradient(90deg,#6366f1,#ec4899);color:white}
.btn-secondary{background:white;color:#4f46e5;border:2px solid #4f46e5}
.input{width:100%;padding:.6rem .8rem;border-radius:14px;border:2px solid #e5e7eb;background:white;color:black}
.set-card{background:white;color:black;border-radius:20px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.18);display:flex;align-items:center;gap:12px;position:relative}
.set-thumb{width:64px;height:64px;border-radius:12px;object-fit:cover;background:#eef}
.stage{perspective:1200px;margin-top:20px;display:flex;justify-content:center}
.card{width:90vw;height:70vh;border-radius:20px;background:white;color:black;position:relative;transform-style:preserve-3d;transition:transform .6s, box-shadow .2s;box-shadow:0 12px 32px rgba(0,0,0,.25);display:flex;align-items:center;justify-content:center;text-align:center;font-weight:700;font-size:1.5rem;overflow:hidden;user-select:none}
.card-face{position:absolute;inset:0;backface-visibility:hidden;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:16px}
.card-back{transform:rotateY(180deg)}
.flipped{transform:rotateY(180deg)}
.card img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:0}
.card span{text-shadow:0 0 6px rgba(0,0,0,.7);z-index:1;color:white;font-size:2rem;font-weight:bold}
.game-btn{position:absolute;top:50%;transform:translateY(-50%);font-size:3rem;cursor:pointer;user-select:none}
#btnMal{left:10px;color:red}
#btnBien{right:10px;color:green}
.hidden{display:none}
</style>
</head>
<body class="pb-20">

<header class="max-w-4xl mx-auto px-4 pt-5 flex items-center justify-between">
  <div class="flex items-center gap-3">
    <div class="w-11 h-11 rounded-2xl bg-white text-indigo-600 grid place-items-center font-extrabold">MQ+</div>
    <div>
      <h1 class="text-2xl font-extrabold drop-shadow">Mini Quizlet ++</h1>
      <p class="text-indigo-100 text-sm -mt-1">√âtudier en s‚Äôamusant ‚ú®</p>
    </div>
  </div>
  <div class="flex items-center gap-2">
    <button id="btnTheme" class="btn btn-secondary">üé® Th√®me</button>
    <button id="btnNewSet" class="btn btn-primary">+ Nouveau set</button>
  </div>
</header>

<main class="max-w-4xl mx-auto px-4 pt-4">
  <!-- HOME -->
  <section id="viewHome" class="space-y-4">
    <div id="setsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
    <p id="emptyMsg" class="text-center text-white/90 hidden">Aucun set. Cr√©e ton premier ‚ú®</p>
  </section>

  <!-- EDITOR -->
  <section id="viewEditor" class="hidden">
    <button class="btn btn-secondary mb-3" id="btnBackHome1">‚Üê Accueil</button>
    <div class="mb-3">
      <input id="setTitle" class="input mb-2" placeholder="Titre du set">
      <input id="setSubject" class="input" placeholder="Mati√®re">
    </div>
    <div id="cardsList" class="space-y-3"></div>
    <button id="btnAddCard" class="btn btn-primary mt-2">+ Ajouter Carte</button>
    <button id="btnStudyFromEditor" class="btn btn-primary mt-2">‚ñ∂ √âtudier</button>
  </section>

  <!-- STUDY -->
  <section id="viewStudy" class="hidden">
    <div class="text-center mb-3">
      <h2 id="studySetTitle" class="text-xl font-extrabold"></h2>
      <p id="studySetSubject"></p>
    </div>
    <div class="stage">
      <div id="card" class="card">
        <img id="cardImg">
        <span id="cardText"></span>
      </div>
      <div id="btnMal" class="game-btn">‚ùå</div>
      <div id="btnBien" class="game-btn">‚úÖ</div>
    </div>
    <div id="studyControls" class="hidden text-center mt-3">
      <button id="btnAgainWrong" class="btn btn-secondary">Reprendre erreurs</button>
      <button id="btnRestartAll" class="btn btn-primary">Tout recommencer</button>
      <button id="btnHome" class="btn btn-secondary">Accueil</button>
    </div>
  </section>
</main>

<template id="tplSet">
  <div class="set-card">
    <img class="set-thumb" />
    <div class="flex-1">
      <div class="font-extrabold set-title text-black/90">Titre</div>
      <div class="text-sm text-slate-500 set-subject">Mati√®re</div>
    </div>
    <div class="flex flex-col gap-2">
      <button class="btn btn-primary btn-edit">Modifier</button>
      <button class="btn btn-primary btn-play">Jouer</button>
      <button class="btn btn-secondary btn-del">Supprimer</button>
    </div>
  </div>
</template>

<template id="tplCardRow">
  <div class="flex flex-col gap-1">
    <input class="input input-front" placeholder="Question">
    <input class="input input-back" placeholder="R√©ponse">
    <input class="input input-img-url" placeholder="URL image (facultatif)">
    <button class="btn btn-secondary btn-del-card">Supprimer</button>
  </div>
</template>

<script>
// --- Donn√©es ---
const LS_KEY='mq_plus_sets';
let sets=[], currentSetId=null, study={order:[],i:0,wrong:[],showingBack:false};

// --- Helpers ---
const $=(s)=>document.querySelector(s);
const $$=(s)=>document.querySelectorAll(s);
const uid=()=>Math.random().toString(36).slice(2,9);

function load(){try{sets=JSON.parse(localStorage.getItem(LS_KEY)||'[]');}catch{sets=[]}}
function save(){localStorage.setItem(LS_KEY,JSON.stringify(sets))}
function findSet(id){return sets.find(s=>s.id===id)}
function upsertSet(s){const i=sets.findIndex(x=>x.id===s.id); if(i>-1) sets[i]=s; else sets.push(s); save()}

// --- Views ---
const viewHome=$('#viewHome'), viewEditor=$('#viewEditor'), viewStudy=$('#viewStudy');
function showHome(){viewHome.classList.remove('hidden'); viewEditor.classList.add('hidden'); viewStudy.classList.add('hidden'); renderHome()}
function showEditor(){viewHome.classList.add('hidden'); viewEditor.classList.remove('hidden'); viewStudy.classList.add('hidden'); renderEditor()}
function showStudy(){viewHome.classList.add('hidden'); viewEditor.classList.add('hidden'); viewStudy.classList.remove('hidden')}

// --- Render Home ---
const setsGrid=$('#setsGrid'), emptyMsg=$('#emptyMsg');
function renderHome(){setsGrid.innerHTML=''; if(!sets.length){emptyMsg.classList.remove('hidden'); return;} emptyMsg.classList.add('hidden');
  const tpl=$('#tplSet'); sets.forEach(s=>{
    const el=tpl.content.cloneNode(true);
    el.querySelector('.set-title').textContent=s.title||'Sans titre';
    el.querySelector('.set-subject').textContent=s.subject||'‚Äî';
    const img=el.querySelector('img');
    img.src=s.cards?.find(c=>c.img)?.img||'https://via.placeholder.com/64';
    el.querySelector('.btn-edit').onclick=()=>{currentSetId=s.id; showEditor();}
    el.querySelector('.btn-play').onclick=()=>{currentSetId=s.id; startStudy(false);}
    el.querySelector('.btn-del').onclick=()=>{if(confirm('Supprimer ce set ?')){sets=sets.filter(x=>x.id!==s.id); save(); renderHome();}}
    setsGrid.appendChild(el)
  })
}

// --- New Set ---
$('#btnNewSet').onclick=()=>{
  const s={id:uid(),title:'Nouveau set',subject:'',cards:[]};
  upsertSet(s); currentSetId=s.id; showEditor();
}

// --- Editor ---
const setTitle=$('#setTitle'), setSubject=$('#setSubject'), cardsList=$('#cardsList');
function renderEditor(){const s=findSet(currentSetId); if(!s){showHome(); return;}
  setTitle.value=s.title; setSubject.value=s.subject; cardsList.innerHTML='';
  const tpl=$('#tplCardRow'); s.cards.forEach((c)=>{
    const row=tpl.content.cloneNode(true);
    const f=row.querySelector('.input-front'); const b=row.querySelector('.input-back'); const img=row.querySelector('.input-img-url'); const del=row.querySelector('.btn-del-card');
    f.value=c.front||''; b.value=c.back||''; img.value=c.img||'';
    f.oninput=()=>{c.front=f.value; save();}
    b.oninput=()=>{c.back=b.value; save();}
    img.oninput=()=>{c.img=img.value; save();}
    del.onclick=()=>{s.cards=s.cards.filter(x=>x!==c); upsertSet(s); renderEditor();}
    cardsList.appendChild(row)
  })
}

$('#btnAddCard').onclick=()=>{
  const s=findSet(currentSetId);
  s.cards.push({front:'',back:'',img:''}); upsertSet(s); renderEditor();
}

$('#btnStudyFromEditor').onclick=()=>{
  const s=findSet(currentSetId); s.title=setTitle.value;s.subject=setSubject.value; upsertSet(s); startStudy(false);
}
$('#btnBackHome1').onclick=showHome;

// --- Study ---
const card=$('#card'), cardText=$('#cardText'), cardImg=$('#cardImg');
const btnMal=$('#btnMal'), btnBien=$('#btnBien');
const studyControls=$('#studyControls'), btnAgainWrong=$('#btnAgainWrong'), btnRestartAll=$('#btnRestartAll'), btnHome=$('#btnHome');
const studySetTitle=$('#studySetTitle'), studySetSubject=$('#studySetSubject');

function startStudy(restartWrong){
  const s=findSet(currentSetId); if(!s||!s.cards.length){alert('Ajoute des cartes !'); return;}
  study.order=restartWrong?study.wrong.slice():s.cards.map(c=>c); study.i=0; study.wrong=[]; study.showingBack=false;
  studySetTitle.textContent=s.title; studySetSubject.textContent=s.subject;
  showStudy(); renderCard();
}

function renderCard(){
  if(study.i>=study.order.length){studyControls.classList.remove('hidden'); card.classList.add('hidden'); return;}
  const c=study.order[study.i]; card.classList.remove('flipped'); study.showingBack=false; card.classList.remove('hidden');
  cardImg.src=c.img||'https://via.placeholder.com/400x300';
  cardText.textContent=c.front;
}

card.onclick=()=>{if(study.i>=study.order.length) return; study.showingBack=!study.showingBack; card.classList.toggle('flipped'); const c=study.order[study.i]; cardText.textContent=study.showingBack?c.back:c.front;}

function markCard(correct){
  const c=study.order[study.i]; if(!correct) study.wrong.push(c);
  study.i++; renderCard();
}

btnMal.onclick=()=>markCard(false);
btnBien.onclick=()=>markCard(true);

btnAgainWrong.onclick=()=>{startStudy(true); studyControls.classList.add('hidden');}
btnRestartAll.onclick=()=>{startStudy(false); studyControls.classList.add('hidden');}
btnHome.onclick=()=>{showHome(); studyControls.classList.add('hidden');}

// --- Init ---
load(); renderHome();
</script>
</body>
</html>

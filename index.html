<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mini-Quizlet ++ (Mobile)</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,#6366f1,#ec4899,#f59e0b);color:white;min-height:100vh}
  .btn{padding:.7rem 1rem;border-radius:9999px;font-weight:700}
  .btn-primary{background:linear-gradient(90deg,#6366f1,#ec4899);color:white}
  .btn-secondary{background:white;color:#4f46e5;border:2px solid #4f46e5}
  .chip{background:#dbeafe;color:#1e3a8a;padding:.25rem .6rem;border-radius:9999px;font-size:.8rem;font-weight:700}
  .input{width:100%;padding:.6rem .8rem;border-radius:14px;border:2px solid #e5e7eb;background:white;color:black}
  .set-card{background:white;color:black;border-radius:20px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.18)}
  .mini-thumb{width:48px;height:48px;border-radius:12px;object-fit:cover;background:#eef}

  /* Card 3D + swipe */
  .stage{perspective:1200px;display:flex;justify-content:center;margin-top:20px}
  .card{width:320px;max-width:90vw;height:220px;border-radius:28px;background-size:cover;background-position:center;background-repeat:no-repeat;color:white;position:relative;transform-style:preserve-3d;transition:transform .6s, box-shadow .2s;box-shadow:0 12px 32px rgba(0,0,0,.25);user-select:none;touch-action:none;display:flex;align-items:center;justify-content:center;padding:14px;text-align:center;}
  .card-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.4);border-radius:28px;}
  .card-content{position:relative;z-index:2;font-size:1.1rem;font-weight:700;}
</style>
</head>
<body class="pb-20">
  <header class="max-w-4xl mx-auto px-4 pt-5 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-11 h-11 rounded-2xl bg-white text-indigo-600 grid place-items-center font-extrabold">MQ+</div>
      <div>
        <h1 class="text-2xl font-extrabold drop-shadow">Mini-Quizlet ++</h1>
        <p class="text-indigo-100 text-sm -mt-1">√âtudier en s‚Äôamusant ‚ú®</p>
      </div>
    </div>
    <div class="flex items-center gap-2">
      <button id="btnTheme" class="btn btn-secondary">üé® Th√®me</button>
      <button id="btnNewSet" class="btn btn-primary">+ Nouveau set</button>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-4 pt-4">
    <!-- HOME: liste des sets -->
    <section id="viewHome" class="space-y-4">
      <div id="setsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
      <p id="emptyMsg" class="text-center text-white/90 hidden">Aucun set. Cr√©e ton premier ‚ú®</p>
    </section>

    <!-- EDITOR -->
    <section id="viewEditor" class="hidden">
      <div class="flex items-center justify-between mb-3">
        <button class="btn btn-secondary" id="btnBackHome1">‚Üê Accueil</button>
        <div class="flex items-center gap-2">
          <button class="btn btn-primary" id="btnStudyFromEditor">‚ñ∂ √âtudier</button>
        </div>
      </div>
      <div class="grid sm:grid-cols-2 gap-3 mb-3">
        <div>
          <label class="text-sm font-bold">Titre du set</label>
          <input id="setTitle" class="input" placeholder="Ex: Vocabulaire anglais">
        </div>
        <div>
          <label class="text-sm font-bold">Mati√®re</label>
          <input id="setSubject" class="input" placeholder="Ex: Anglais">
        </div>
      </div>
      <div class="flex items-center justify-between mb-2">
        <h3 class="font-extrabold">Cartes</h3>
        <button id="btnAddCard" class="btn btn-primary">+ Ajouter</button>
      </div>
      <div id="cardsList" class="space-y-3"></div>
    </section>

    <!-- STUDY -->
    <section id="viewStudy" class="hidden">
      <div class="flex items-center justify-between mb-2">
        <button class="btn btn-secondary" id="btnBackHome2">‚Üê Accueil</button>
        <div class="flex items-center gap-2">
          <span id="progressChip" class="chip">0/0</span>
        </div>
      </div>
      <div class="text-center mb-2">
        <div id="studySetTitle" class="text-xl font-extrabold"></div>
      </div>

      <div class="stage">
        <div id="card" class="card">
          <div class="card-overlay"></div>
          <div class="card-content" id="cardText">Texte</div>
        </div>
      </div>

      <div class="mt-5 flex flex-wrap items-center justify-center gap-2">
        <button id="btnAgainWrong" class="btn btn-secondary">Reprendre erreurs</button>
        <button id="btnRestartAll" class="btn btn-primary">Tout recommencer</button>
        <button id="btnHome" class="btn btn-secondary">üè† Home</button>
      </div>
    </section>
  </main>

<script>
const LS_KEY='mq_plus_sets';
let sets=[], currentSetId=null, study={order:[],i:0,wrong:[],finished:false};

const $=(s)=>document.querySelector(s), $$=(s)=>document.querySelectorAll(s);
const uid=()=>Math.random().toString(36).slice(2,9);

function load(){try{sets=JSON.parse(localStorage.getItem(LS_KEY)||'[]');}catch{sets=[]}}
function save(){localStorage.setItem(LS_KEY,JSON.stringify(sets));}
function findSet(id){return sets.find(s=>s.id===id)}
function upsertSet(s){const i=sets.findIndex(x=>x.id===s.id); if(i>-1) sets[i]=s; else sets.push(s); save();}

const viewHome=$('#viewHome'), viewEditor=$('#viewEditor'), viewStudy=$('#viewStudy');
const setsGrid=$('#setsGrid');

function showHome(){viewHome.classList.remove('hidden');viewEditor.classList.add('hidden');viewStudy.classList.add('hidden'); renderHome();}
function showEditor(){viewHome.classList.add('hidden');viewEditor.classList.remove('hidden');viewStudy.classList.add('hidden');}
function showStudy(){viewHome.classList.add('hidden');viewEditor.classList.add('hidden');viewStudy.classList.remove('hidden');}

function renderHome(){setsGrid.innerHTML=''; if(!sets.length){$('#emptyMsg').classList.remove('hidden'); return;} $('#emptyMsg').classList.add('hidden');
  sets.forEach(s=>{
    const div=document.createElement('div');
    div.className='set-card p-4 flex items-center justify-between';
    div.innerHTML=`<div><div class='font-extrabold text-black/90'>${s.title||'Sans titre'}</div><div class='text-sm text-slate-500'>${s.subject||'‚Äî'}</div></div><div class='flex gap-2'><button class='btn btn-primary btn-play'>‚ñ∂ Jouer</button><button class='btn btn-primary btn-edit'>‚úèÔ∏è Modifier</button></div>`;
    div.querySelector('.btn-play').onclick=()=>{currentSetId=s.id; startStudy(false);};
    div.querySelector('.btn-edit').onclick=()=>{currentSetId=s.id; showEditor();};
    setsGrid.appendChild(div);
  });
}

$('#btnNewSet').onclick=()=>{const s={id:uid(),title:'Nouveau set',subject:'',cards:[]}; upsertSet(s); currentSetId=s.id; showEditor();};
$('#btnBackHome1').onclick=showHome;
$('#btnBackHome2').onclick=showHome;
$('#btnHome').onclick=showHome;
$('#btnAddCard').onclick=()=>{const s=findSet(currentSetId); s.cards.push({id:uid(),front:'Question',back:'R√©ponse',img:''}); upsertSet(s); renderEditor();};
$('#btnStudyFromEditor').onclick=()=>{const s=findSet(currentSetId); s.title=$('#setTitle').value.trim(); s.subject=$('#setSubject').value.trim(); upsertSet(s); startStudy(false);};

function renderEditor(){const s=findSet(currentSetId); if(!s) return; $('#setTitle').value=s.title; $('#setSubject').value=s.subject; const cardsList=$('#cardsList'); cardsList.innerHTML=''; s.cards.forEach(c=>{
  const div=document.createElement('div');
  div.className='set-card p-3';
  div.innerHTML=`<input class='input input-front' placeholder='Recto (question)' value='${c.front}'><input class='input input-back' placeholder='Verso (r√©ponse)' value='${c.back}'>`;
  div.querySelector('.input-front').addEventListener('input',e=>{c.front=e.target.value; save();});
  div.querySelector('.input-back').addEventListener('input',e=>{c.back=e.target.value; save();});
  cardsList.appendChild(div);
});
}

function startStudy(restartWrong){const s=findSet(currentSetId); if(!s||!s.cards.length){alert('Ajoute des cartes !'); return;}
  study.order=restartWrong?study.wrong.slice():s.cards.map(c=>c.id); study.i=0; study.wrong=[]; study.finished=false; $('#studySetTitle').textContent=s.title||'Sans titre'; updateStudyCard(); showStudy();
}

function currentCard(){return findSet(currentSetId).cards.find(c=>c.id===study.order[study.i])}
function updateStudyCard(){const s=findSet(currentSetId); const c=currentCard(); const cardEl=$('#card'); const cardText=$('#cardText');
  if(!c){study.finished=true; cardText.textContent='Fin du set'; return;}
  cardEl.style.backgroundImage=c.img?`url(${c.img})`:'none';
  cardText.textContent=c.front+' / '+c.back;
}

// Swipe pour marquer Bien/Mal
let startX=0, dragging=false;
const cardEl=$('#card');
cardEl.addEventListener('touchstart',e=>{dragging=true; startX=e.touches[0].clientX;});
cardEl.addEventListener('touchmove',e=>{if(!dragging) return; const dx=e.touches[0].clientX-startX; cardEl.style.transform=`translateX(${dx}px)`;});
cardEl.addEventListener('touchend',e=>{if(!dragging) return; dragging=false; const dx=e.changedTouches[0].clientX-startX; const TH=80; if(dx>TH){markCard(true);} else if(dx<-TH){markCard(false);} cardEl.style.transform='';});

function markCard(ok){const c=currentCard(); if(!c) return; if(!ok) study.wrong.push(c.id); study.i++; updateStudyCard();}
$('#btnAgainWrong').onclick=()=>{if(!study.wrong.length){alert('Aucune erreur √† reprendre'); return;} startStudy(true);};
$('#btnRestartAll').onclick=()=>startStudy(false);

load(); renderHome();
</script>
</body>
</html>

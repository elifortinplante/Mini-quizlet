<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mini-Quizlet Complet</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,#6366f1,#ec4899,#f59e0b);color:white;min-height:100vh}
  .btn{padding:.7rem 1rem;border-radius:9999px;font-weight:700}
  .btn-primary{background:linear-gradient(90deg,#6366f1,#ec4899);color:white}
  .btn-secondary{background:white;color:#4f46e5;border:2px solid #4f46e5}
  .input{width:100%;padding:.6rem .8rem;border-radius:14px;border:2px solid #e5e7eb;background:white;color:black}
  .set-card{background:white;color:black;border-radius:20px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.18)}
  .mini-thumb{width:48px;height:48px;border-radius:12px;object-fit:cover;background:#eef}
</style>
</head>
<body class="pb-20">
<header class="max-w-4xl mx-auto px-4 pt-5 flex items-center justify-between">
  <div class="flex items-center gap-3">
    <div class="w-11 h-11 rounded-2xl bg-white text-indigo-600 grid place-items-center font-extrabold">MQ+</div>
    <div>
      <h1 class="text-2xl font-extrabold drop-shadow">Mini-Quizlet ++</h1>
      <p class="text-indigo-100 text-sm -mt-1">√âtudier en s‚Äôamusant ‚ú®</p>
    </div>
  </div>
  <div class="flex items-center gap-2">
    <button id="btnTheme" class="btn btn-secondary">üé® Th√®me</button>
    <button id="btnNewSet" class="btn btn-primary">+ Nouveau set</button>
  </div>
</header>
<main class="max-w-4xl mx-auto px-4 pt-4">
  <!-- HOME -->
  <section id="viewHome" class="space-y-4">
    <div id="setsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
    <p id="emptyMsg" class="text-center text-white/90 hidden">Aucun set. Cr√©e ton premier ‚ú®</p>
  </section>

  <!-- EDITOR -->
  <section id="viewEditor" class="hidden">
    <div class="flex items-center justify-between mb-3">
      <button class="btn btn-secondary" id="btnBackHome1">‚Üê Accueil</button>
      <div class="flex items-center gap-2">
        <button class="btn btn-secondary" id="btnExport">Exporter</button>
        <label class="btn btn-secondary" for="importInput">Importer</label>
        <input id="importInput" type="file" accept="application/json" class="hidden" />
        <button class="btn btn-primary" id="btnStudyFromEditor">‚ñ∂ √âtudier</button>
      </div>
    </div>
    <div class="grid sm:grid-cols-2 gap-3 mb-3">
      <div>
        <label class="text-sm font-bold">Titre du set</label>
        <input id="setTitle" class="input" placeholder="Ex: Vocabulaire anglais">
      </div>
      <div>
        <label class="text-sm font-bold">Mati√®re</label>
        <input id="setSubject" class="input" placeholder="Ex: Anglais">
      </div>
    </div>
    <div class="flex items-center justify-between mb-2">
      <h3 class="font-extrabold">Cartes</h3>
      <button id="btnAddCard" class="btn btn-primary">+ Ajouter</button>
    </div>
    <div id="cardsList" class="space-y-3"></div>
    <p id="noCardsMsg" class="hidden">Aucune carte.</p>
  </section>

  <!-- STUDY -->
  <section id="viewStudy" class="hidden">
    <div class="flex items-center justify-between mb-2">
      <button class="btn btn-secondary" id="btnBackHome2">‚Üê Accueil</button>
      <div class="flex items-center gap-2">
        <span id="scoreChip" class="btn btn-secondary">Score: 0</span>
        <span id="progressChip" class="btn btn-secondary">0/0</span>
      </div>
    </div>
    <div id="studySetTitle" class="text-xl font-extrabold text-center mb-3"></div>
    <div class="set-card p-6 text-center">
      <img id="cardImg" class="w-full h-64 object-contain mb-3" alt="">
      <div id="cardText" class="text-lg font-bold"></div>
    </div>
    <div class="mt-5 flex flex-wrap items-center justify-center gap-2">
      <button id="btnAgainWrong" class="btn btn-secondary">Reprendre erreurs</button>
      <button id="btnRestartAll" class="btn btn-primary">Tout recommencer</button>
      <button id="btnNext" class="btn btn-secondary">‚Üí Suivant</button>
    </div>
  </section>
</main>
<script>
// --- Data ---
const LS_KEY='mq_plus_sets';
let sets=[], currentSetId=null, study={order:[],i:0,wrong:[],score:0};
const $=(s)=>document.querySelector(s);
const uid=()=>Math.random().toString(36).slice(2,9);
function load(){try{sets=JSON.parse(localStorage.getItem(LS_KEY)||'[]');}catch{sets=[]}}
function save(){localStorage.setItem(LS_KEY,JSON.stringify(sets));}
function findSet(id){return sets.find(s=>s.id===id)}
function upsertSet(s){const i=sets.findIndex(x=>x.id===s.id);if(i>-1)sets[i]=s;else sets.push(s);save();}

// --- Views ---
const viewHome=$('#viewHome'), viewEditor=$('#viewEditor'), viewStudy=$('#viewStudy');
const setsGrid=$('#setsGrid'), emptyMsg=$('#emptyMsg');
function showHome(){viewHome.classList.remove('hidden');viewEditor.classList.add('hidden');viewStudy.classList.add('hidden');renderHome();}
function showEditor(){viewHome.classList.add('hidden');viewEditor.classList.remove('hidden');viewStudy.classList.add('hidden');renderEditor();}
function showStudy(){viewHome.classList.add('hidden');viewEditor.classList.add('hidden');viewStudy.classList.remove('hidden');}

// --- Home ---
function renderHome(){setsGrid.innerHTML='';if(!sets.length){emptyMsg.classList.remove('hidden');return;}emptyMsg.classList.add('hidden');
sets.forEach(s=>{
  const div=document.createElement('div');
  div.className='set-card flex items-center justify-between';
  div.innerHTML=`<div><b>${s.title}</b><br><span>${s.subject||''}</span></div>
  <div><button class='btn btn-primary btn-play'>Jouer</button></div>`;
  div.querySelector('.btn-play').onclick=()=>{currentSetId=s.id;startStudy();};
  setsGrid.appendChild(div);
});}
$('#btnNewSet').onclick=()=>{const s={id:uid(),title:'Nouveau set',subject:'',cards:[]};upsertSet(s);currentSetId=s.id;showEditor();};

// --- Editor ---
const setTitle=$('#setTitle'), setSubject=$('#setSubject'), cardsList=$('#cardsList'), noCardsMsg=$('#noCardsMsg');
function renderEditor(){const s=findSet(currentSetId);if(!s){showHome();return;}setTitle.value=s.title;setSubject.value=s.subject;cardsList.innerHTML='';
if(!s.cards.length) noCardsMsg.classList.remove('hidden'); else noCardsMsg.classList.add('hidden');
s.cards.forEach(c=>{
  const div=document.createElement('div');
  div.className='set-card p-3';
  div.innerHTML=`<input class='input input-front' placeholder='Question' value='${c.front||''}'><br>
  <input class='input input-back' placeholder='R√©ponse' value='${c.back||''}'><br>
  <input class='input input-img' placeholder='URL image' value='${c.img||''}'><br>
  <button class='btn btn-secondary btn-del-card'>Supprimer</button>`;
  div.querySelector('.input-front').addEventListener('input',e=>{c.front=e.target.value;save();});
  div.querySelector('.input-back').addEventListener('input',e=>{c.back=e.target.value;save();});
  div.querySelector('.input-img').addEventListener('input',e=>{c.img=e.target.value;save();});
  div.querySelector('.btn-del-card').onclick=()=>{s.cards=s.cards.filter(x=>x!==c);upsertSet(s);renderEditor();};
  cardsList.appendChild(div);
});}
$('#btnAddCard').onclick=()=>{const s=findSet(currentSetId);s.cards.push({front:'',back:'',img:''});upsertSet(s);renderEditor();};
$('#btnStudyFromEditor').onclick=()=>{const s=findSet(currentSetId);s.title=setTitle.value;s.subject=setSubject.value;upsertSet(s);startStudy();};
$('#btnBackHome1').onclick=showHome;

// --- Study ---
const cardImg=$('#cardImg'), cardText=$('#cardText'), scoreChip=$('#scoreChip'), progressChip=$('#progressChip');
$('#btnBackHome2').onclick=showHome;
function startStudy(){
  const s=findSet(currentSetId);if(!s||!s.cards.length){alert('Ajoute des cartes');return;}
study.order=s.cards.map((c,i)=>i);study.i=0;study.wrong=[];study.score=0;updateCard();showStudy();}
function updateCard(){const s=findSet(currentSetId);if(study.i>=study.order.length){cardImg.src='';cardText.textContent='Fin';return;}
const c=s.cards[study.order[study.i]];cardImg.src=c.img||'';cardText.textContent=c.front+' ‚Üí '+c.back;scoreChip.textContent='Score: '+study.score;progressChip.textContent=(study.i+1)+'/'+study.order.length;}
$('#btnNext').onclick=()=>{study.i++;updateCard();};
$('#btnRestartAll').onclick=()=>{startStudy();};
$('#btnAgainWrong').onclick=()=>{study.order=study.wrong.slice();study.i=0;study.wrong=[];study.score=0;updateCard();};

// --- Init ---
load();renderHome();
</script>
</body>
</html>

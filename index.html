<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Quizlet Color√©</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; background:linear-gradient(135deg,#a78bfa,#f472b6,#34d399); color:white; min-height:100vh;}
header, main {max-width:800px; margin:auto; padding:1rem;}
.btn {padding:.7rem 1rem; border-radius:9999px; font-weight:700; cursor:pointer;}
.btn-primary {background:linear-gradient(90deg,#a78bfa,#f472b6); color:white;}
.btn-secondary {background:white; color:#4f46e5; border:2px solid #4f46e5;}
.input {width:100%; padding:.6rem .8rem; border-radius:14px; border:2px solid #e5e7eb; background:white; color:black;}
.set-card {background:white;color:black; border-radius:20px; padding:14px; box-shadow:0 8px 24px rgba(0,0,0,.18);}
.stage {position:relative; perspective:1200px; width:100%; height:80vh; margin-top:1rem;}
.card {width:100%; height:100%; border-radius:20px; background:white; color:black; position:relative; transform-style:preserve-3d; transition:transform .6s; display:flex; align-items:center; justify-content:center; text-align:center; overflow:hidden; font-size:1.8rem; font-weight:bold; text-shadow:1px 1px 3px #000;}
.card-face {position:absolute; inset:0; display:flex; align-items:center; justify-content:center; backface-visibility:hidden; padding:1rem;}
.card-front {transform:rotateY(0); background-size:cover; background-position:center;}
.card-back {transform:rotateY(180deg); background-size:cover; background-position:center;}
.flipped {transform:rotateY(180deg);}
.overlay-btn {position:absolute; top:50%; transform:translateY(-50%); font-size:4rem; cursor:pointer; user-select:none; z-index:10;}
.overlay-btn.left {left:15px; color:red;}
.overlay-btn.right {right:15px; color:lime;}
.hidden {display:none;}
.final-buttons {margin-top:20px; display:flex; gap:10px; justify-content:center;}
</style>
</head>
<body>
<header class="flex items-center justify-between">
  <h1 class="text-2xl font-extrabold drop-shadow">Mini-Quizlet Color√©</h1>
  <button id="btnNewSet" class="btn btn-primary">+ Nouveau set</button>
</header>

<main>
<section id="viewHome">
  <div id="setsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4"></div>
  <p id="emptyMsg" class="text-center text-white/90 hidden">Aucun set. Cr√©e ton premier ‚ú®</p>
</section>

<section id="viewEditor" class="hidden">
  <div class="flex items-center justify-between mb-3">
    <button class="btn btn-secondary" id="btnBackHome1">‚Üê Accueil</button>
    <button class="btn btn-primary" id="btnStudyFromEditor">‚ñ∂ √âtudier</button>
  </div>
  <div class="grid sm:grid-cols-2 gap-3 mb-3">
    <div>
      <label class="text-sm font-bold">Titre du set</label>
      <input id="setTitle" class="input" placeholder="Ex: Vocabulaire anglais">
    </div>
    <div>
      <label class="text-sm font-bold">Mati√®re</label>
      <input id="setSubject" class="input" placeholder="Ex: Anglais">
    </div>
    <div>
      <label class="text-sm font-bold">Image URL du set</label>
      <input id="setImgUrl" class="input" placeholder="https://...">
    </div>
  </div>
  <div class="flex items-center justify-between mb-2">
    <h3 class="font-extrabold">Cartes</h3>
    <button id="btnAddCard" class="btn btn-primary">+ Ajouter</button>
  </div>
  <div id="cardsList" class="space-y-3"></div>
  <p id="noCardsMsg" class="hidden">Aucune carte.</p>
</section>

<section id="viewStudy" class="hidden">
  <div class="text-center mb-2">
      <div id="studySetTitle" class="text-xl font-extrabold"></div>
      <div id="studySetSubject" class="text-sm font-bold"></div>
      <div id="progressChip" class="chip mt-1">0/0</div>
  </div>
  <div class="stage">
    <div id="card" class="card"></div>
    <div class="overlay-btn left hidden" id="btnMal">‚ùå</div>
    <div class="overlay-btn right hidden" id="btnBien">‚úÖ</div>
  </div>
  <div class="final-buttons hidden" id="finalBtns">
    <button class="btn btn-primary" id="btnRetryWrong">Reprendre les erreurs</button>
    <button class="btn btn-primary" id="btnRestartAll">Tout recommencer</button>
    <button class="btn btn-secondary" id="btnHome">Accueil</button>
  </div>
</section>

<template id="tplSet">
  <div class="set-card p-4 flex items-center gap-3">
    <img class="mini-thumb w-16 h-16 rounded-xl object-cover bg-gray-200">
    <div class="flex-1">
      <div class="font-extrabold text-black/90 set-title">Titre</div>
      <div class="text-sm text-slate-500 set-subject">Mati√®re</div>
    </div>
    <div class="flex flex-col gap-2">
      <button class="btn btn-primary btn-edit">Modifier</button>
      <button class="btn btn-primary btn-play">Jouer</button>
      <button class="btn btn-secondary btn-del">Supprimer</button>
    </div>
  </div>
</template>

<template id="tplCardRow">
  <div class="set-card p-3">
    <input class="input input-front mb-2" placeholder="Question">
    <input class="input input-back mb-2" placeholder="R√©ponse">
    <input class="input input-img mb-2" placeholder="URL image (optionnel)">
    <button class="btn btn-secondary btn-del-card">üóëÔ∏è Supprimer la carte</button>
  </div>
</template>

<script>
// --- Gestion local storage ---
const LS_KEY='mq_plus_sets';
let sets=[]; let currentSetId=null;
let study={order:[],i:0,wrong:[],flipped:false,finished:false};

const $=(s)=>document.querySelector(s);
const uid=()=>Math.random().toString(36).slice(2,9);

function load(){try{sets=JSON.parse(localStorage.getItem(LS_KEY)||'[]');}catch{sets=[]}}
function save(){localStorage.setItem(LS_KEY,JSON.stringify(sets))}
function findSet(id){return sets.find(s=>s.id===id)}
function upsertSet(s){const i=sets.findIndex(x=>x.id===s.id); i>-1?sets[i]=s:sets.push(s); save();}

// --- Views ---
const viewHome=$('#viewHome'), viewEditor=$('#viewEditor'), viewStudy=$('#viewStudy');
const setsGrid=$('#setsGrid'), emptyMsg=$('#emptyMsg');
const finalBtns=$('#finalBtns'), btnBien=$('#btnBien'), btnMal=$('#btnMal');
const studySetTitle=$('#studySetTitle'), studySetSubject=$('#studySetSubject'), progressChip=$('#progressChip');
const card=$('#card');

// --- Home ---
function showHome(){viewHome.classList.remove('hidden'); viewEditor.classList.add('hidden'); viewStudy.classList.add('hidden'); renderHome();}
function showEditor(){viewHome.classList.add('hidden'); viewEditor.classList.remove('hidden'); viewStudy.classList.add('hidden'); renderEditor();}
function showStudy(){viewHome.classList.add('hidden'); viewEditor.classList.add('hidden'); viewStudy.classList.remove('hidden');}
function renderHome(){setsGrid.innerHTML=''; if(!sets.length){emptyMsg.classList.remove('hidden'); return;} emptyMsg.classList.add('hidden');
sets.forEach(s=>{const tpl=$('#tplSet').content.cloneNode(true);
tpl.querySelector('.set-title').textContent=s.title||'Sans titre';
tpl.querySelector('.set-subject').textContent=s.subject||'‚Äî';
tpl.querySelector('.mini-thumb').src=s.img||'https://via.placeholder.com/48';
tpl.querySelector('.btn-edit').onclick=()=>{currentSetId=s.id; showEditor();};
tpl.querySelector('.btn-play').onclick=()=>{currentSetId=s.id; startStudy();};
tpl.querySelector('.btn-del').onclick=()=>{if(confirm('Supprimer ce set ?')){sets=sets.filter(x=>x.id!==s.id); save(); renderHome();}};
setsGrid.appendChild(tpl);
});}

$('#btnNewSet').onclick=()=>{const s={id:uid(),title:'Nouveau set',subject:'',img:'',cards:[]}; upsertSet(s); currentSetId=s.id; showEditor();};

// --- Editor ---
const setTitle=$('#setTitle'), setSubject=$('#setSubject'), setImgUrl=$('#setImgUrl'), cardsList=$('#cardsList'), noCardsMsg=$('#noCardsMsg');
$('#btnBackHome1').onclick=()=>{currentSetId=null; showHome();}
$('#btnAddCard').onclick=()=>{addCardRow({question:'',answer:'',img:''}); saveCurrentSet();}
$('#btnStudyFromEditor').onclick=()=>{saveCurrentSet(); startStudy();}
function renderEditor(){const s=findSet(currentSetId); if(!s) return;
setTitle.value=s.title; setSubject.value=s.subject; setImgUrl.value=s.img; cardsList.innerHTML=''; if(!s.cards.length) noCardsMsg.classList.remove('hidden'); else noCardsMsg.classList.add('hidden');
s.cards.forEach(c=>addCardRow(c));
}
function saveCurrentSet(){const s=findSet(currentSetId); if(!s) return;
s.title=setTitle.value; s.subject=setSubject.value; s.img=setImgUrl.value;
s.cards=Array.from(cardsList.children).map(r=>({question:r.querySelector('.input-front').value, answer:r.querySelector('.input-back').value, img:r.querySelector('.input-img').value}));
upsertSet(s);
}
function addCardRow(c){const tpl=$('#tplCardRow'); const el=tpl.content.cloneNode(true);
el.querySelector('.input-front').value=c.question; el.querySelector('.input-back').value=c.answer; el.querySelector('.input-img').value=c.img;
el.querySelector('.btn-del-card').onclick=e=>{e.target.closest('.set-card').remove(); saveCurrentSet();};
cardsList.appendChild(el); saveCurrentSet();}

// --- Study ---
btnBien.onclick=()=>{markCard(true);}; btnMal.onclick=()=>{markCard(false);};
$('#btnRetryWrong').onclick=()=>{study.order=study.wrong; study.i=0; study.wrong=[]; study.finished=false; finalBtns.classList.add('hidden'); btnBien.classList.remove('hidden'); btnMal.classList.remove('hidden'); updateCardView();}
$('#btnRestartAll').onclick=()=>{startStudy();}
$('#btnHome').onclick=()=>{showHome();}
card.onclick=()=>{if(study.finished) return; study.flipped=!study.flipped; updateCardView();}
function startStudy(){const s=findSet(currentSetId); if(!s || !s.cards.length){alert('Ce set est vide.'); return;}
study={order:s.cards.map((c,i)=>i), i:0, wrong:[], flipped:false, finished:false}; showStudy(); updateStudyHeader(); updateCardView(); btnBien.classList.remove('hidden'); btnMal.classList.remove('hidden'); finalBtns.classList.add('hidden');}
function updateStudyHeader(){const s=findSet(currentSetId); studySetTitle.textContent=s.title; studySetSubject.textContent=s.subject;}
function updateCardView(){const s=findSet(currentSetId); if(!s) return;
if(study.i>=study.order.length){study.finished=true; card.textContent='Termin√© !'; btnBien.classList.add('hidden'); btnMal.classList.add('hidden'); finalBtns.classList.remove('hidden'); return;}
const idx=study.order[study.i]; const c=s.cards[idx]; card.innerHTML=study.flipped?c.answer:c.question;
card.style.backgroundImage=`url(${c.img||s.img||''})`;
card.classList.toggle('flipped',study.flipped);
progressChip.textContent=`${study.i+1}/${study.order.length}`;}
function markCard(ok){if(!study.finished){if(!ok) study.wrong.push(study.order[study.i]); study.i++; study.flipped=false; updateCardView();}}

load(); renderHome();
</script>
</body>
</html>

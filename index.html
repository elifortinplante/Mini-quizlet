<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mini Quizlet Final</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,#6366f1,#ec4899,#f59e0b);color:white;min-height:100vh}
  .btn{padding:.7rem 1rem;border-radius:9999px;font-weight:700}
  .btn-primary{background:linear-gradient(90deg,#6366f1,#ec4899);color:white}
  .btn-secondary{background:white;color:#4f46e5;border:2px solid #4f46e5}
  .input{width:100%;padding:.6rem .8rem;border-radius:14px;border:2px solid #e5e7eb;background:white;color:black}
  .set-card{background:white;color:black;border-radius:20px;padding:14px;box-shadow:0 8px 24px rgba(0,0,0,.18)}
  .stage{perspective:1200px}
  .card{width:320px;max-width:90vw;height:220px;border-radius:28px;background:white;color:black;position:relative;transform-style:preserve-3d;transition:transform .6s, box-shadow .2s;box-shadow:0 12px 32px rgba(0,0,0,.25);user-select:none;touch-action:none;margin-inline:auto;display:flex;align-items:center;justify-content:center;text-align:center;padding:10px;}
  .card-face{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;backface-visibility:hidden;}
  .card-front{transform:rotateY(0);}
  .card-back{transform:rotateY(180deg);}
  .flipped{transform:rotateY(180deg);}
  .card img{max-width:100%;max-height:100%;object-fit:contain;position:absolute;top:0;left:0;z-index:0;border-radius:28px;}
  .card-text{position:relative;z-index:1;font-size:1.1rem;font-weight:700;padding:5px;text-align:center;}
</style>
</head>
<body>
<header class="max-w-4xl mx-auto px-4 pt-5 flex items-center justify-between">
  <div class="flex items-center gap-3">
    <div class="w-11 h-11 rounded-2xl bg-white text-indigo-600 grid place-items-center font-extrabold">MQ</div>
    <div>
      <h1 class="text-2xl font-extrabold drop-shadow">Mini Quizlet Final</h1>
      <p class="text-indigo-100 text-sm -mt-1">Étudier en s’amusant ✨</p>
    </div>
  </div>
  <button id="btnNewSet" class="btn btn-primary">+ Nouveau set</button>
</header>
<main class="max-w-4xl mx-auto px-4 pt-4">
<section id="viewHome" class="space-y-4">
  <div id="setsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
</section>
<section id="viewStudy" class="hidden">
  <div class="flex items-center justify-between mb-2">
    <button id="btnBackHome" class="btn btn-secondary">← Accueil</button>
    <div>
      <span id="setTitleDisplay" class="font-bold"></span> - <span id="setSubjectDisplay"></span>
    </div>
  </div>
  <div class="stage mt-3">
    <div id="card" class="card">
      <img id="cardImg" src="" alt="">
      <div class="card-face card-front"><div id="frontText" class="card-text"></div></div>
      <div class="card-face card-back"><div id="backText" class="card-text"></div></div>
    </div>
  </div>
  <div class="mt-5 flex flex-wrap items-center justify-center gap-2">
    <button id="btnAgainWrong" class="btn btn-secondary">Reprendre erreurs</button>
    <button id="btnRestartAll" class="btn btn-primary">Tout recommencer</button>
  </div>
</section>
</main>
<script>
const LS_KEY='mq_final_sets';
let sets=[],currentSetId=null,study={order:[],i:0,wrong:[],finished:false};
const cardEl=$('#card'),frontText=$('#frontText'),backText=$('#backText'),cardImg=$('#cardImg');
function $(s){return document.querySelector(s);}
function uid(){return Math.random().toString(36).slice(2,9);}
function load(){try{sets=JSON.parse(localStorage.getItem(LS_KEY)||'[]');}catch{sets=[];}}
function save(){localStorage.setItem(LS_KEY,JSON.stringify(sets));}
function findSet(id){return sets.find(s=>s.id===id)}
function renderHome(){const grid=$('#setsGrid');grid.innerHTML='';sets.forEach(s=>{const div=document.createElement('div');div.className='set-card p-4 flex items-center justify-between';
div.innerHTML=`<div><div class='font-bold'>${s.title}</div><div class='text-sm'>${s.subject}</div></div><button class='btn btn-primary'>Jouer</button>`;
div.querySelector('button').onclick=()=>{currentSetId=s.id;startStudy(false);};grid.appendChild(div);});}
$('#btnNewSet').onclick=()=>{const s={id:uid(),title:'Nouveau set',subject:'Matière',cards:[{front:'Question 1',back:'Réponse 1',img:''}]};sets.push(s);save();renderHome();};
$('#btnBackHome').onclick=()=>{$('#viewStudy').classList.add('hidden');$('#viewHome').classList.remove('hidden');};
function startStudy(restartWrong){const s=findSet(currentSetId);if(!s||!s.cards.length)return;study.order=restartWrong?study.wrong.slice():s.cards.map(c=>c.id);study.i=0;study.wrong=[];study.finished=false;$('#viewHome').classList.add('hidden');$('#viewStudy').classList.remove('hidden');$('#setTitleDisplay').textContent=s.title;$('#setSubjectDisplay').textContent=s.subject;updateCard();}
function currentCard(){return findSet(currentSetId).cards.find(c=>c.id===study.order[study.i]);}
function updateCard(){const s=findSet(currentSetId);const c=currentCard();if(!c){study.finished=true;return;}frontText.textContent=c.front;backText.textContent=c.back;cardImg.src=c.img||'';}
cardEl.addEventListener('click',()=>{cardEl.classList.toggle('flipped');});
// Swipe
let startX=0,dragging=false;
cardEl.addEventListener('touchstart',e=>{dragging=true;startX=e.touches[0].clientX;});
cardEl.addEventListener('touchmove',e=>{if(!dragging)return;const dx=e.touches[0].clientX-startX;cardEl.style.transform=`translateX(${dx}px)`;});
cardEl.addEventListener('touchend',e=>{if(!dragging)return;dragging=false;const dx=e.changedTouches[0].clientX-startX;const TH=50;const s=findSet(currentSetId);const c=currentCard();if(dx>TH){study.i++;updateCard();}else if(dx<-TH){study.wrong.push(c.id);study.i++;updateCard();}cardEl.style.transform='';});
$('#btnRestartAll').onclick=()=>startStudy(false);
$('#btnAgainWrong').onclick=()=>{if(!study.wrong.length)return;startStudy(true);};
load();renderHome();
</script>
</body>
</html>

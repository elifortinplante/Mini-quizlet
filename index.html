<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Quizlet ++</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body {margin:0; font-family:system-ui; background: linear-gradient(135deg,#6366f1,#ec4899,#f59e0b); color:white; min-height:100vh;}
  .btn {padding:.7rem 1rem; border-radius:9999px; font-weight:700;}
  .btn-primary {background:linear-gradient(90deg,#6366f1,#ec4899); color:white;}
  .btn-secondary {background:white; color:#4f46e5; border:2px solid #4f46e5;}
  .input {width:100%; padding:.6rem .8rem; border-radius:14px; border:2px solid #e5e7eb; background:white; color:black;}
  .set-card {background:white; color:black; border-radius:20px; padding:14px; box-shadow:0 8px 24px rgba(0,0,0,.18); display:flex; gap:10px; align-items:center;}
  .mini-thumb {width:48px;height:48px;border-radius:12px;object-fit:cover;background:#eef;}
  .stage {perspective:1200px; display:flex; justify-content:center; align-items:center; height:70vh;}
  .card {width:95vw; height:75vh; border-radius:28px; position:relative; transform-style:preserve-3d; transition: transform .6s; box-shadow:0 12px 32px rgba(0,0,0,.25); display:flex; justify-content:center; align-items:center; overflow:hidden; background:white; color:black;}
  .card-face {position:absolute; inset:0; display:flex; justify-content:center; align-items:center; backface-visibility:hidden; text-align:center; padding:16px;}
  .card-front {transform:rotateY(0);}
  .card-back {transform:rotateY(180deg);}
  .flipped {transform:rotateY(180deg);}
  .card img {position:absolute; inset:0; width:100%; height:100%; object-fit:cover; z-index:0;}
  .card-text {position:relative; z-index:2; font-size:1.3rem; font-weight:700; color:white; text-shadow: 2px 2px 6px rgba(0,0,0,0.7);}
  .emoji-btn {position:absolute; top:50%; transform:translateY(-50%); font-size:3rem; cursor:pointer; user-select:none;}
  .emoji-left {left:5%;}
  .emoji-right {right:5%;}
</style>
</head>
<body>
<header class="max-w-4xl mx-auto px-4 pt-5 flex items-center justify-between">
  <div class="flex items-center gap-3">
    <div class="w-11 h-11 rounded-2xl bg-white text-indigo-600 grid place-items-center font-extrabold">MQ+</div>
    <div>
      <h1 class="text-2xl font-extrabold drop-shadow">Mini-Quizlet ++</h1>
      <p class="text-indigo-100 text-sm -mt-1">√âtudier en s‚Äôamusant ‚ú®</p>
    </div>
  </div>
  <div class="flex items-center gap-2">
    <button id="btnNewSet" class="btn btn-primary">+ Nouveau set</button>
  </div>
</header>

<main class="max-w-4xl mx-auto px-4 pt-4">
  <!-- HOME -->
  <section id="viewHome" class="space-y-4">
    <div id="setsGrid" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
    <p id="emptyMsg" class="text-center text-white/90 hidden">Aucun set. Cr√©e ton premier ‚ú®</p>
  </section>

  <!-- EDITOR -->
  <section id="viewEditor" class="hidden">
    <div class="flex items-center justify-between mb-3">
      <button class="btn btn-secondary" id="btnBackHome1">‚Üê Accueil</button>
      <button class="btn btn-primary" id="btnStudyFromEditor">‚ñ∂ √âtudier</button>
    </div>
    <div class="grid sm:grid-cols-2 gap-3 mb-3">
      <div>
        <label class="text-sm font-bold">Titre du set</label>
        <input id="setTitle" class="input" placeholder="Ex: Vocabulaire anglais">
      </div>
      <div>
        <label class="text-sm font-bold">Mati√®re</label>
        <input id="setSubject" class="input" placeholder="Ex: Anglais">
      </div>
      <div>
        <label class="text-sm font-bold">Image de l‚Äôaper√ßu du set (URL)</label>
        <input id="setImage" class="input" placeholder="Ex: https://...">
      </div>
    </div>
    <div class="flex items-center justify-between mb-2">
      <h3 class="font-extrabold">Cartes</h3>
      <button id="btnAddCard" class="btn btn-primary">+ Ajouter</button>
    </div>
    <div id="cardsList" class="space-y-3"></div>
  </section>

  <!-- STUDY -->
  <section id="viewStudy" class="hidden">
    <div class="text-center mb-2">
      <div id="studySetTitle" class="text-xl font-extrabold"></div>
      <div id="studySetSubject" class="text-sm mb-2"></div>
    </div>
    <div class="stage">
      <div id="card" class="card">
        <div class="card-front card-face"><span id="frontText" class="card-text"></span></div>
        <div class="card-back card-face"><span id="backText" class="card-text"></span></div>
      </div>
    </div>
    <div class="emoji-btn emoji-left" id="btnWrong">‚ùå</div>
    <div class="emoji-btn emoji-right" id="btnRight">‚úÖ</div>
    <div id="endButtons" class="flex justify-center gap-2 mt-4 hidden">
      <button id="btnAgainWrong" class="btn btn-secondary">Reprendre erreurs</button>
      <button id="btnRestartAll" class="btn btn-primary">Tout recommencer</button>
      <button id="btnBackHome2" class="btn btn-secondary">Accueil</button>
    </div>
  </section>
</main>

<template id="tplSet">
  <div class="set-card p-4 flex items-center gap-3">
    <img class="mini-thumb"/>
    <div class="flex-1">
      <div class="font-extrabold text-black/90 set-title">Titre</div>
      <div class="text-sm text-slate-500 set-subject">Mati√®re</div>
      <div class="text-xs text-slate-500 set-count">0 cartes</div>
    </div>
    <div class="flex flex-col gap-2">
      <button class="btn btn-primary btn-edit">Modifier</button>
      <button class="btn btn-primary btn-play">Jouer</button>
      <button class="btn btn-secondary btn-del">Supprimer</button>
    </div>
  </div>
</template>

<template id="tplCardRow">
  <div class="set-card p-3">
    <input class="input input-front" placeholder="Question">
    <input class="input input-back" placeholder="R√©ponse">
    <input class="input input-img-url" placeholder="Image URL (facultatif)">
    <button class="btn btn-secondary btn-del-card">üóëÔ∏è Carte</button>
  </div>
</template>

<script>
const LS_KEY='mq_plus_sets';
let sets=[]; 
let currentSetId=null;
let study={order:[],i:0,wrong:[],finished:false};

const $=(s)=>document.querySelector(s);
const uid=()=>Math.random().toString(36).slice(2,9);

function load(){try{sets=JSON.parse(localStorage.getItem(LS_KEY)||'[]');}catch{sets=[]}}
function save(){localStorage.setItem(LS_KEY,JSON.stringify(sets));}
function findSet(id){return sets.find(s=>s.id===id)}
function upsertSet(s){const i=sets.findIndex(x=>x.id===s.id); if(i>-1) sets[i]=s; else sets.push(s); save();}

const viewHome=$('#viewHome'), viewEditor=$('#viewEditor'), viewStudy=$('#viewStudy');
const setsGrid=$('#setsGrid');

function showHome(){viewHome.classList.remove('hidden');viewEditor.classList.add('hidden');viewStudy.classList.add('hidden'); renderHome();}
function showEditor(){viewHome.classList.add('hidden');viewEditor.classList.remove('hidden'); viewStudy.classList.add('hidden'); renderEditor();}
function showStudy(){viewHome.classList.add('hidden');viewEditor.classList.add('hidden');viewStudy.classList.remove('hidden');}

function renderHome(){
  setsGrid.innerHTML=''; 
  if(!sets.length){$('#emptyMsg').classList.remove('hidden'); return;} $('#emptyMsg').classList.add('hidden');
  const tpl=$('#tplSet');
  sets.forEach(s=>{
    const el=tpl.content.cloneNode(true);
    const card=el.querySelector('.set-card'); 
    const img=el.querySelector('img'); img.src=s.image||'https://via.placeholder.com/48';
    el.querySelector('.set-title').textContent=s.title||'Sans titre';
    el.querySelector('.set-subject').textContent=s.subject||'Sans mati√®re';
    el.querySelector('.set-count').textContent=(s.cards?.length||0)+' cartes';
    el.querySelector('.btn-edit').onclick=()=>{currentSetId=s.id; showEditor(); renderEditor();}
    el.querySelector('.btn-play').onclick=()=>{currentSetId=s.id; startStudy();}
    el.querySelector('.btn-del').onclick=()=>{if(confirm('Supprimer ce set ?')){sets=sets.filter(x=>x.id!==s.id);save(); renderHome();}}
    setsGrid.appendChild(el);
  })
}

function renderEditor(){
  const s=findSet(currentSetId); if(!s) return;
  $('#setTitle').value=s.title||'';
  $('#setSubject').value=s.subject||'';
  $('#setImage').value=s.image||'';
  const cardsList=$('#cardsList'); cardsList.innerHTML='';
  (s.cards||[]).forEach(c=>{
    addCardRow(c);
  })
}

function addCardRow(card={}){
  const tpl=$('#tplCardRow'); const el=tpl.content.cloneNode(true);
  const row=el.querySelector('.set-card'); 
  const inputFront=row.querySelector('.input-front'); inputFront.value=card.front||'';
  const inputBack=row.querySelector('.input-back'); inputBack.value=card.back||'';
  const inputImg=row.querySelector('.input-img-url'); inputImg.value=card.img||'';
  inputFront.oninput=inputBack.oninput=inputImg.oninput=()=>{saveEditor();};
  row.querySelector('.btn-del-card').onclick=()=>{row.remove(); saveEditor();}
  $('#cardsList').appendChild(el);
}

function saveEditor(){
  const s=findSet(currentSetId); if(!s) return;
  s.title=$('#setTitle').value;
  s.subject=$('#setSubject').value;
  s.image=$('#setImage').value;
  s.cards=[];
  $('#cardsList .set-card').forEach(r=>{
    s.cards.push({
      front:r.querySelector('.input-front').value,
      back:r.querySelector('.input-back').value,
      img:r.querySelector('.input-img-url').value
    })
  })
  upsertSet(s);
  renderHome();
}

$('#btnNewSet').onclick=()=>{
  const newSet={id:uid(),title:'',subject:'',image:'',cards:[]};
  sets.push(newSet); save(); currentSetId=newSet.id; showEditor(); renderEditor();
}
$('#btnAddCard').onclick=()=>addCardRow();

$('#btnBackHome1').onclick=()=>showHome();
$('#btnBackHome2').onclick=()=>showHome();


// STUDY LOGIC
const cardEl=$('#card'), frontText=$('#frontText'), backText=$('#backText'), btnRight=$('#btnRight'), btnWrong=$('#btnWrong');
const studySetTitle=$('#studySetTitle'), studySetSubject=$('#studySetSubject'), endButtons=$('#endButtons');
const btnAgainWrong=$('#btnAgainWrong'), btnRestartAll=$('#btnRestartAll'), btnStudyFromEditor=$('#btnStudyFromEditor');

function startStudy(){
  const s=findSet(currentSetId); if(!s) return;
  study.order=s.cards.map((_,i)=>i);
  study.i=0; study.wrong=[]; study.finished=false;
  studySetTitle.textContent=s.title;
  studySetSubject.textContent=s.subject;
  showStudy(); renderCard();
}

function renderCard(){
  const s=findSet(currentSetId); if(!s) return;
  if(study.i>=study.order.length){study.finished=true; endButtons.classList.remove('hidden'); cardEl.style.display='none'; return;}
  endButtons.classList.add('hidden'); cardEl.style.display='flex';
  const c=s.cards[study.order[study.i]];
  cardEl.classList.remove('flipped');
  frontText.textContent=c.front||'';
  backText.textContent=c.back||'';
  cardEl.style.background=c.img?`url(${c.img}) center/cover no-repeat`:'white';
  frontText.style.color=c.img?'white':'black';
  backText.style.color=c.img?'white':'black';
}

cardEl.onclick=()=>{cardEl.classList.toggle('flipped');}

function markCard(correct){
  const s=findSet(currentSetId); if(!s) return;
  if(!correct) study.wrong.push(study.order[study.i]);
  study.i++; renderCard();
}

btnRight.onclick=()=>markCard(true);
btnWrong.onclick=()=>markCard(false);

btnRestartAll.onclick=()=>{study.i=0; study.wrong=[]; study.finished=false; renderCard();}
btnAgainWrong.onclick=()=>{study.order=study.wrong.slice(); study.i=0; study.wrong=[]; study.finished=false; renderCard();}

btnStudyFromEditor.onclick=()=>{currentSetId=currentSetId; startStudy();}

load(); renderHome();
</script>
</body>
</html>

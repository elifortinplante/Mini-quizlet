<!-- Ajouter avant ton script actuel -->
<script type="module">
  // 1️⃣ Import Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
  import { getFirestore, doc, collection, setDoc, getDocs, getDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";

  // 2️⃣ Configuration Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyB66qfMVZJxnFN0h8d3NHjCgTzrrJpZu28",
    authDomain: "quizlet-7eec7.firebaseapp.com",
    projectId: "quizlet-7eec7",
    storageBucket: "quizlet-7eec7.appspot.com",
    messagingSenderId: "650458729476",
    appId: "1:650458729476:web:82876ae94a85ca0d2cb951"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // 3️⃣ Variables
  let currentUser = null;

  // 4️⃣ Ajouter un écran de login
  const loginHTML = `
    <div id="login-screen">
      <h2>Connexion / Inscription</h2>
      <input type="email" id="email" placeholder="Email"><br><br>
      <input type="password" id="password" placeholder="Mot de passe"><br><br>
      <button id="btn-login">Se connecter</button>
      <button id="btn-signup">S'inscrire</button>
    </div>
  `;
  document.body.insertAdjacentHTML('afterbegin', loginHTML);

  const loginScreen = document.getElementById('login-screen');
  loginScreen.style.display = 'flex';
  loginScreen.style.flexDirection = 'column';
  loginScreen.style.alignItems = 'center';
  loginScreen.style.justifyContent = 'center';
  loginScreen.style.height = '100vh';

  // 5️⃣ Fonctions login / signup
  document.getElementById('btn-signup').onclick = async () => {
    const email = document.getElementById('email').value;
    const pass = document.getElementById('password').value;
    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
      currentUser = userCredential.user;
      loadUserSets();
      loginScreen.style.display = 'none';
      document.getElementById("home-screen").classList.remove("hidden");
    } catch(e) { alert(e.message); }
  };

  document.getElementById('btn-login').onclick = async () => {
    const email = document.getElementById('email').value;
    const pass = document.getElementById('password').value;
    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, pass);
      currentUser = userCredential.user;
      loadUserSets();
      loginScreen.style.display = 'none';
      document.getElementById("home-screen").classList.remove("hidden");
    } catch(e) { alert(e.message); }
  };

  // 6️⃣ État connecté
  onAuthStateChanged(auth, (user) => {
    if(user){
      currentUser = user;
      loginScreen.style.display = 'none';
      document.getElementById("home-screen").classList.remove("hidden");
      loadUserSets();
    }
  });

  // 7️⃣ Sauvegarde et chargement depuis Firestore
  async function saveSetsToFirestore() {
    if(!currentUser) return;
    const setsRef = doc(db, "users", currentUser.uid);
    await setDoc(setsRef, { sets: sets });
  }

  async function loadUserSets() {
    if(!currentUser) return;
    const setsRef = doc(db, "users", currentUser.uid);
    const docSnap = await getDoc(setsRef);
    if(docSnap.exists()){
      sets = docSnap.data().sets || [];
    } else {
      sets = [];
    }
    displaySets();
  }

  // 8️⃣ Modifier tes fonctions existantes pour appeler saveSetsToFirestore à la place de localStorage
  const originalSaveSets = saveSets;
  saveSets = () => {
    originalSaveSets();
    saveSetsToFirestore();
  };

</script>
